<html>
<style>
.overlayBox{
	border: thin black solid;
	position: absolute;
	z-index:5;
}
.overlayBox:hover{
	border: thin black solid;
	position: absolute;
	background: rgba(255, 255, 255, 0.2);
}
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jq
uery.min.js" ></script>
<script src="https://x2js.googlecode.com/hg/xml2json.js"></script>
<script>
var x2js = new X2JS();
var neumeObjects = [];
var jsonData;
var currentTarget;


$(function()
{
	$('#imageInput').change(function(e)
	{
	    var reader = new FileReader();
	    reader.onload = function(e) 
	    {
	    	drawImage(this.result);
	    };
	    reader.readAsDataURL(this.files[0]);
	});
	$('#fileInput').change(function(e)
	{
	    var reader = new FileReader();
	    reader.onload = function(e) 
	    {
	    	loadOverlay(this.result);
	    };
	    reader.readAsText(this.files[0]);
	});
});

function drawImage(imageIn)
{
	var image = new Image;
	image.src = imageIn;
	var canvas = document.getElementById("mainCanvas");
    canvas.height=image.height;
    canvas.width=image.width;
    var ctx = canvas.getContext("2d");
    ctx.drawImage(image, 0, 0);
    $("#xmlShow").css('display', 'inline');

}

function loadOverlay(fileData)
{
	var canvas = document.getElementById("mainCanvas");
	var ctx = canvas.getContext("2d");
	jsonData = x2js.xml_str2json(fileData);
	xmlns = jsonData['mei']['_xmlns']
	var curX, curY, endX, endY;
	neumeArray = jsonData['mei']['music']['body']['neume'];
	facsArray = jsonData['mei']['music']['facsimile']['surface']['zone'];
	for(curNeumeIndex in neumeArray)
	{
		curNeume = neumeArray[curNeumeIndex];
		facsID = curNeume._facs;
		for(curZoneIndex in facsArray)
		{
			curZone = facsArray[curZoneIndex];
			if (curZone["_xml:id"] == facsID)
			{
				neumeObjects[facsID] = curNeume['_name']
				curX = curZone._ulx;
				curY = curZone._uly;
				endX = curZone._lrx;
				endY = curZone._lry;
				break;
			}
		}
		createBox(facsID, curX, curY, (endX - curX), (endY - curY));
	}
	$(".overlayBox").on('mouseover', function(e)
	{
		currentTarget = e.target.id;
		$("#hoverdiv").html(neumeObjects[e.target.id]);
		$("#hoverdiv").css(
		{
			'top': e.pageY - 50,
			'height': 40,
			'left': e.pageX,
			'padding-left': '10px',
			'padding-right': '10px',
			'border': 'thin black solid',
			'background': '#FFFFFF',
			'display': 'block',
			'vertical-align': 'middle',
		});

		$(document).on('mousemove', function(e)
		{
			if(isOutside(e))
			{
				currentTarget = "";
				$(document).unbind('mousemove');
				$("#hoverdiv").css('display', 'none');
			}	
			$("#hoverdiv").css(
			{
				'top': e.pageY - 50,
				'left': e.pageX,
			});
		});

	});
}

function isOutside(e)
{
	if(!currentTarget)
	{
		return false;
	}
	target = $("#"+currentTarget);
	if(e.pageX < target.offset().left)
	{
		return true;
	} else if (e.pageX > (target.offset().left + target.width())) 
	{
		return true;
	} else if (e.pageY < target.offset().top) 
	{
		return true;
	} else if (e.pageY > (target.offset().top + target.height())) 
	{
		return true;
	}
	return false;
}

function createBox(facsID, thisX, thisY, thisWidth, thisHeight)
{
	editedY = parseInt(thisY) + $("#mainCanvas").offset().top;
	var newString = "<div id='"+facsID+"' class='overlayBox' style='top:"+editedY+";left:"+thisX+";height:"+thisHeight+";width:"+thisWidth+";'></div>";
	$("#boxes").html($("#boxes").html() + newString);
}

</script>

Image: <input type="file" id="imageInput"><br>

<div id="xmlShow" style="display:none;"> XML: <input type="file" id="fileInput"></div><br>

<canvas id="mainCanvas">
</canvas>
<span id = "hoverdiv" style="z-index:50;position:absolute;"></span>
<div id = "boxes"></div>

</html>