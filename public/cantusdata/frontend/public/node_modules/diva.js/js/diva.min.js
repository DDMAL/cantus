!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?exports.diva=t(require("jquery")):e.diva=t(e.jQuery)}(this,function(e){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){i(1),e.exports=i(7)},function(e,t,i){var n=i(2);n.registerPlugin(i(6)),n.registerPlugin(i(41)),n.registerPlugin(i(42)),n.registerPlugin(i(43)),n.registerPlugin(i(44)),n.registerPlugin(i(45))},function(e,t,i){function n(e){var t=e.id?"#"+e.id:e.id,i=e.className?"."+e.className.split(/\s+/g).join("."):"";return(t?t:e.tagName.toLowerCase())+i}var o=i(3),r=i(4),a=i(5),s=e.exports={Events:new r,registerPlugin:function(e){a.register(e)},create:function(e,t){if(s.find(e))throw new Error("Diva is already initialized on "+n(e));var i=o(e);return i.diva(t),i.data("diva")},find:function(e){return o(e).data("diva")||null}}},function(t,i){t.exports=e},function(e,t){function i(){this._cache={}}e.exports=i,i.prototype.publish=function(e,t,i){if(this._cache[e]){var n=this._cache[e];if("undefined"!=typeof n.global)for(var o=n.global,r=o.length,a=0;a<r;a++)o[a].apply(i||null,t||[]);if(i&&"undefined"!=typeof i.getInstanceId){var s=i.getInstanceId();if(this._cache[e][s])for(var l=this._cache[e][s],c=l.length,u=0;u<c;u++)l[u].apply(i,t||[])}}},i.prototype.subscribe=function(e,t,i){this._cache[e]||(this._cache[e]={}),"string"==typeof i?(this._cache[e][i]||(this._cache[e][i]=[]),this._cache[e][i].push(t)):(this._cache[e].global||(this._cache[e].global=[]),this._cache[e].global.push(t));var n=i?[e,t,i]:[e,t];return n},i.prototype.unsubscribe=function(e,t){var i=e[0];if(this._cache[i]){var n,o=3===e.length?e[2]:"global";if(n=this._cache[i][o],!n)return!1;if(t)return delete this._cache[i][o],n.length>0;for(var r=n.length;r--;)if(n[r]===e[1])return this._cache[i][o].splice(r,1),!0}return!1},i.prototype.unsubscribeAll=function(e){if(e)for(var t,i=Object.keys(this._cache),n=i.length;n--;)t=i[n],"undefined"!=typeof this._cache[t][e]&&delete this._cache[t][e];else this._cache={}}},function(e,t){var i=[];e.exports={register:function(e){i.push(e)},getAll:function(){return i}}},function(e,t,i){var n=i(3),o=i(7);!function(t){e.exports=function(){var e={},i={init:function(i,n){function r(e){return Math.log(e)/Math.log(10)}var a,s,l,c,u;n.startScrolling=function(){return i.currentlyAutoScrolling?void console.warn("You are trying to start autoscrolling, but it is already scrolling."):(t("#"+i.ID+"autoscroll-toggle").text("Turn off"),s&&n.disableScrollable(),i.currentlyAutoScrolling=!0,void h())};var h=function(){clearInterval(i.autoScrollInterval),i.verticallyOriented?i.autoScrollInterval=setInterval(function(){i.viewportObject.scrollTop(i.viewportObject.scrollTop()+a)},l):i.autoScrollInterval=setInterval(function(){i.viewportObject.scrollLeft(i.viewportObject.scrollLeft()+a)},l)};n.stopScrolling=function(){return i.currentlyAutoScrolling?(t("#"+i.ID+"autoscroll-toggle").text("Turn on"),s&&n.enableScrollable(),i.currentlyAutoScrolling=!1,void clearInterval(i.autoScrollInterval)):void console.warn("You are trying to stop autoscrolling, but it is not currently active.")},n.toggleScrolling=function(){i.currentlyAutoScrolling?n.stopScrolling():n.startScrolling()},n.changeRefresh=function(e){l=e,d()},n.changeScrollSpeed=function(e){u=e,d(),t("#"+i.ID+"autoscroll-pps").val(r(u)),i.currentlyAutoScrolling&&h()};var d=function(){l=c,a=u/(1e3/l),a<1&&(l*=1/a,a=u/(1e3/l))};if(n.disableManualScroll=function(){s=!0,i.currentlyAutoScrolling&&n.disableScrollable()},n.enableManualScroll=function(){s=!1,i.currentlyAutoScrolling&&n.enableScrollable()},i.currentlyAutoScrolling=!1,i.autoScrollInterval="",s=i.disableManualScroll||!1,l=i.autoScrollRefresh||50,c=l,n.changeScrollSpeed(i.scrollSpeed||10),t(window).on("keyup",function(e){e.shiftKey&&32===e.keyCode&&n.toggleScrolling()}),!i.disableAutoscrollPrefs){var g=function(n){if(i.inFullscreen){var o=t(i.selector+"tools"),r=o.css("right");e.jqObj.css({right:r,"margin-right":0,top:o.offset().top+o.outerHeight()+15})}else e.jqObj.css({right:t(window).width()-(i.viewportObject.offset().left+i.viewportObject.outerWidth())+i.scrollbarWidth,"margin-right":".6em"}),e.jqObj.offset({top:i.viewportObject.offset().top+1})};o.Events.subscribe("ModeDidSwitch",g,i.ID),o.Events.subscribe("ViewerDidLoad",function(o){var a="<div id='"+i.ID+"autoscroll-prefs' class='diva-autoscroll-prefs diva-popup'><b>Autoscrolling options:</b><br><span class='diva-autoscroll-prefs-text'>Speed:</span><input type='range' id='"+i.ID+"autoscroll-pps' class='diva-autoscroll-pps diva-autoscroll-prefs-input' value='"+r(u)+"' min='0' max='3' step='0.1'><br><span class='diva-autoscroll-prefs-text'>Allow manual scroll:</span><input type='checkbox' id='"+i.ID+"autoscroll-manual' class='diva-autoscroll-manual diva-autoscroll-prefs-input' checked='checked'><br><button id='"+i.ID+"autoscroll-toggle' class='diva-autoscroll-prefs-toggle diva-autoscroll-prefs-input'> Turn on </button></div>";t("#"+i.ID+"page-nav").before("<div id='"+i.ID+"autoscroll-icon' class='diva-button diva-autoscroll-icon' title='Expand autoscroll options'></div>"),t("body").prepend(a),t("#"+i.ID+"autoscroll-pps").on("change",function(e){n.changeScrollSpeed(Math.pow(10,e.target.value))}),t("#"+i.ID+"autoscroll-manual").on("change",function(e){e.target.checked?n.enableManualScroll():n.disableManualScroll()}),t("#"+i.ID+"autoscroll-toggle").on("click",n.toggleScrolling),t("#"+i.ID+"autoscroll-icon").on("click",function(n){e.jqObj=t("#"+i.ID+"autoscroll-prefs"),"none"===e.jqObj.css("display")?(e.jqObj.css({display:"block"}),g(i.inFullscreen)):e.jqObj.css("display","none")})},i.ID)}},pluginName:"autoscroll",titleText:"Automatically scrolls page along primary axis"};return i}()}(n)},function(e,t,i){var n=i(3),o=i(8),r=i(9),a=i(10),s=i(2),l=i(11),c=i(13),u=i(14);new a;e.exports=s,function(e){var t=function(t,i){var n,a,h,d=this;i=e.extend({adaptivePadding:.05,arrowScrollAmount:40,blockMobileMove:!1,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGotoSuggestions:!0,enableGridIcon:!0,enableGridControls:"buttons",enableImageTitles:!0,enableKeyScroll:!0,enableLinkIcon:!0,enableNonPagedVisibilityIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fillParentHeight:!0,fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,hashParamSuffix:null,iipServerURL:"",inFullscreen:!1,inBookLayout:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,minPagesPerRow:2,minZoomLevel:0,onGotoSubmit:null,pageAliases:{},pageAliasFunction:function(){return!1},pageLoadTimeout:200,pagesPerRow:5,showNonPagedPages:!1,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentObject:null,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},i);var g=function(e){return f(n.manifest,e)},f=function(e,t){var i,n=e.pages.length;for(i=0;i<n;i++)if(e.pages[i].f===t)return i;return-1},p=function(e){return n.manifest.isPageValid(e,n.showNonPagedPages)},v=function(e){return h.viewerCore.reload(e)},m=function(e){switch(e){case"document":return v({inGrid:!1,inBookLayout:!1});case"book":return v({inGrid:!1,inBookLayout:!0});case"grid":return v({inGrid:!0});default:return!1}},w=function(){var e=!n.verticallyOriented;return v({inGrid:!1,verticallyOriented:e,goDirectlyTo:n.currentPageIndex,verticalOffset:h.viewerCore.getYOffset(),horizontalOffset:h.viewerCore.getXOffset()}),e},y=function(){v({inFullscreen:!n.inFullscreen})},b=function(){var e;e=n.inGrid?"g":n.inBookLayout?"b":"d";var t=h.viewerCore.getCurrentLayout(),i=t.getPageToViewportCenterOffset(n.currentPageIndex,a.viewport),o={f:n.inFullscreen,v:e,z:n.zoomLevel,n:n.pagesPerRow,i:!!n.enableFilename&&n.manifest.pages[n.currentPageIndex].f,p:!n.enableFilename&&n.currentPageIndex+1,y:!!i&&i.y,x:!!i&&i.x};return o},_=function(e,t){t=t||n.manifest;var i="v"in e?I(e.v):{};"f"in e&&(i.inFullscreen=e.f),"z"in e&&(i.zoomLevel=e.z),"n"in e&&(i.pagesPerRow=e.n);var o=f(t,e.i);if(o>=0&&o<t.pages.length||(o=e.p-1,o>=0&&o<t.pages.length||(o=null)),null!==o){var r=parseInt(e.x,10),a=parseInt(e.y,10);i.goDirectlyTo=o,i.horizontalOffset=r,i.verticalOffset=a}return i},P=function(){var e,t=b(),i=[];for(e in t)t[e]!==!1&&i.push(e+n.hashParamSuffix+"="+encodeURIComponent(t[e]));return i.join("&")},x=function(){return location.protocol+"//"+location.host+location.pathname+location.search+"#"+P()},I=function(e){switch(e){case"d":return{inGrid:!1,inBookLayout:!1};case"b":return{inGrid:!1,inBookLayout:!0};case"g":return{inGrid:!0,inBookLayout:!1};default:return null}},L=function(e){h.viewerCore.showError(e)},C=function(e,t,i){var r=["Invalid objectData setting. Error code: "+e.status+" "+i],a=0===n.objectData.lastIndexOf("http",0);if(a&&""===i){var s=n.objectData.replace(/https?:\/\//i,"").split(/[\/?#]/)[0];location.hostname!==s&&r.push(o("p","Attempted to access cross-origin data without CORS."),o("p","You may need to update your server configuration to support CORS. For help, see the ",o("a",{href:"https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests",target:"_blank"},"cross-site request documentation.")))}L(r)},O=function(e,t){var i,o;!e.hasOwnProperty("@context")||e["@context"].indexOf("iiif")===-1&&e["@context"].indexOf("shared-canvas")===-1?(console.warn("Usage of IIP manifests is deprecated. Consider switching to IIIF manifests. Visit http://iiif.io/ for more information."),i=!1,o=l.fromLegacyManifest(e,{iipServerURL:n.iipServerURL,imageDir:n.imageDir})):(i=!0,s.Events.publish("ManifestDidLoad",[e],d),o=l.fromIIIF(e));var r=t?_(t,o):{};h.viewerCore.setManifest(o,i,r)},D=function(){var e={};return["f","v","z","n","i","p","y","x"].forEach(function(t){var i=r.get(t+n.hashParamSuffix);i!==!1&&(e[t]=i)}),"true"===e.f?e.f=!0:"false"===e.f&&(e.f=!1),["z","n","p","x","y"].forEach(function(t){t in e&&(e[t]=parseInt(e[t],10))}),e},T=function(){return!!a.loaded||(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),!1)},k=function(){var r=o("div",{"class":"diva-wrapper"+(i.fillParentHeight?" diva-wrapper-flexbox":"")});t.appendChild(r),i.toolbarParentObject=i.toolbarParentObject||e(r);var s=new u(r,i,d);a=s.getInternalState(),n=s.getSettings(),r.id=n.ID+"wrapper",h={viewerCore:s,toolbar:n.enableToolbar?c(d):null};var l=D();if("object"==typeof n.objectData)setTimeout(function(){O(n.objectData,l)},0);else{var g=e.ajax({url:n.objectData,cache:!0,dataType:"json",error:C,success:function(e){O(e,l)}});s.setPendingManifestRequest(g)}};this.getItemTitle=function(){return n.manifest.itemTitle},this.gotoPageByNumber=function(e,t,i){console.warn("This method is deprecated. Consider using gotoPageByIndex(pageIndex, xAnchor, yAnchor) instead.");var n=parseInt(e,10)-1;return this.gotoPageByIndex(n,t,i)},this.gotoPageByIndex=function(e,t,i){if(e=parseInt(e,10),p(e)){var n=h.viewerCore.getXOffset(e,t),o=h.viewerCore.getYOffset(e,i);return a.renderer["goto"](e,o,n),!0}return!1},this.getNumberOfPages=function(){return!!T()&&n.numPages},this.getPageDimensions=function(e){return T()?h.viewerCore.getCurrentLayout().getPageDimensions(e):null},this.getPageDimensionsAtZoomLevel=function(e,t){if(!T())return!1;t>n.maxZoomLevel&&(t=n.maxZoomLevel);var i=n.manifest.pages[parseInt(e,10)],o=i.d[parseInt(t,10)];return{width:o.w,height:o.h}},this.getPageDimensionsAtCurrentZoomLevel=function(e){if(e=p(e)?e:n.currentPageIndex,!p(e))throw new Error("Invalid Page Index");return h.viewerCore.getCurrentLayout().getPageDimensions(e)},this.getCurrentPageDimensionsAtCurrentZoomLevel=function(){return this.getPageDimensionsAtCurrentZoomLevel(n.currentPageIndex)},this.isReady=function(){return a.loaded},this.getCurrentPageIndex=function(){return n.currentPageIndex},this.getCurrentPageFilename=function(){return n.manifest.pages[n.currentPageIndex].f},this.getCurrentPageNumber=function(){return console.warn("This method is deprecated. Consider using getCurrentPageIndex() instead."),n.currentPageIndex+1},this.getFilenames=function(){for(var e=[],t=0;t<n.numPages;t++)e[t]=n.manifest.pages[t].f;return e},this.getZoomLevel=function(){return n.zoomLevel},this.getMaxZoomLevel=function(){return n.maxZoomLevel},this.getMaxZoomLevelForPage=function(e){return!!T&&n.manifest.pages[e].m},this.getMinZoomLevel=function(){return n.minZoomLevel},this.setZoomLevel=function(e){return n.inGrid&&v({inGrid:!1}),h.viewerCore.zoom(e)},this.getGridPagesPerRow=function(){return this.pagesPerRow},this.setGridPagesPerRow=function(e){return!!h.viewerCore.isValidOption("pagesPerRow",e)&&v({inGrid:!0,pagesPerRow:e})},this.zoomIn=function(){return this.setZoomLevel(n.zoomLevel+1)},this.zoomOut=function(){return this.setZoomLevel(n.zoomLevel-1)},this.isRegionInViewport=function(e,t,i,n,o){var r=h.viewerCore.getCurrentLayout();if(!r)return!1;var s=r.getPageOffset(e),l=s.top+i,c=s.left+t;return a.viewport.intersectsRegion({top:l,bottom:l+o,left:c,right:c+n})},this.isPageInViewport=function(e){return a.renderer.isPageVisible(e)},this.isPageLoaded=function(e){return console.warn("This method is deprecated. Consider using isPageInViewport(pageIndex) instead."),this.isPageInViewport(e)},this.toggleFullscreenMode=function(){y()},this.toggleNonPagedPagesVisibility=function(){v({showNonPagedPages:!n.showNonPagedPages})},this.showNonPagedPages=function(){v({showNonPagedPages:!0})},this.hideNonPagedPages=function(){v({showNonPagedPages:!1})},this.closePopups=function(){h.toolbar.closePopups()},this.enterFullscreenMode=function(){return!n.inFullscreen&&(y(),!0)},this.leaveFullscreenMode=function(){return!!n.inFullscreen&&(y(),!0)},this.changeView=function(e){return m(e)},this.enterGridView=function(){return!n.inGrid&&(m("grid"),!0)},this.leaveGridView=function(){return!!n.inGrid&&(v({inGrid:!1}),!0)},this.gotoPageByName=function(e,t,i){var n=g(e);return this.gotoPageByIndex(n,t,i)},this.gotoPageByLabel=function(e,t,i){for(var o=n.manifest.pages,r=0,a=o.length;r<a;r++)if(o[r].l.toLowerCase().indexOf(e.toLowerCase())>-1)return this.gotoPageByIndex(r,t,i);var s=parseInt(e,10)-1;return this.gotoPageByIndex(s,t,i)},this.getPageIndex=function(e){return g(e)},this.getCurrentURL=function(){return x()},this.isPageIndexValid=function(e){return p(e)},this.getURLHash=function(){return P()},this.getState=function(){return b()},this.setState=function(e){v(_(e))},this.getInstanceSelector=function(){return n.selector},this.getInstanceId=function(){return n.ID},this.getSettings=function(){return n},this.translateFromMaxZoomLevel=function(e){var t=n.maxZoomLevel-n.zoomLevel;return e/Math.pow(2,t)},this.translateToMaxZoomLevel=function(e){var t=n.maxZoomLevel-n.zoomLevel;return 0===t?e:e*Math.pow(2,t)},this.enableScrollable=function(){h.viewerCore.enableScrollable()},this.disableScrollable=function(){h.viewerCore.disableScrollable()},this.toggleOrientation=function(){return w()},this.getPageOffset=function(e,t){var i=h.viewerCore.getPageRegion(e,t);return{top:i.top,left:i.left}},this.getCurrentPageOffset=function(){return this.getPageOffset(n.currentPageIndex)},this.getPageDimensionsAtCurrentGridLevel=function(e){return console.warn("This method is deprecated. Consider using getPageDimensionsAtCurrentZoomLevel(pageIndex) instead."),this.getPageDimensionsAtCurrentZoomLevel(e)},this.getPageIndexForPageXYValues=function(e,t){var i=a.outerElement.getBoundingClientRect(),n=i.top,o=i.left,r=i.bottom,s=i.right;if(e<o||e>s)return-1;if(t<n||t>r)return-1;for(var l=document.getElementsByClassName("diva-page"),c=l.length;c--;){var u=l[c],h=u.getBoundingClientRect();if(!(e<h.left||e>h.right||t<h.top||t>h.bottom))return u.getAttribute("data-index")}return-1},this.getPageImageURL=function(e,t){return n.manifest.getPageImageURL(e,t)},this.isVerticallyOriented=function(){return n.verticallyOriented},this.changeObject=function(t){return a.loaded=!1,h.viewerCore.clear(),a.renderer&&a.renderer.destroy(),a.options.objectData=t,"object"==typeof t?void setTimeout(function(){O(t)}):(a.throbberTimeoutID=setTimeout(function(){e(n.selector+"throbber").show()},n.throbberTimeout),void e.ajax({url:n.objectData,cache:!0,dataType:"json",error:C,success:function(e){O(e)}}))},this.activate=function(){a.isActiveDiva=!0},this.deactivate=function(){a.isActiveDiva=!1},this.destroy=function(){h.viewerCore.destroy()},this.__addPageOverlay=function(e){h.viewerCore.addPageOverlay(e)},this.__removePageOverlay=function(e){h.viewerCore.removePageOverlay(e)},this.getAliasForPageIndex=function(e){var t=parseInt(e,10);return n.pageAliases[t]||n.pageAliasFunction(t)||t+1},this.getPageIndexForAlias=function(e){for(var t=0;t<n.numPages;t++)if(this.getAliasForPageIndex(t)===e)return t;return!1},this.getPageIndicesForAlias=function(e){for(var t=[],i=0;i<n.numPages;i++)this.getAliasForPageIndex(i)===e&&t.push(i);return t},this.getCurrentAliasedPageIndex=function(){return this.getAliasForPageIndex(n.currentPageIndex)},this.gotoPageByAliasedNumber=function(e,t,i){return this.gotoPageByIndex(this.getPageIndexForAlias(e),t,i)},k()};e.fn.diva=function(i){return this.each(function(){var n=e(this);if(!n.data("diva")){if(!document.body.contains(this))throw new Error("Diva could not be initialized because this element is not attached to the DOM");var o=new t(this,i);n.data("diva",o)}})}}(n)},function(e,t){function i(e){for(var t=document.createElement(e),i=Array.prototype.slice.call(arguments,1);i.length;){var o=i.shift();n(t,o)}return t}function n(e,t){if(null!=t)if("object"!=typeof t&&"function"!=typeof t)e.appendChild(document.createTextNode(t));else if(t instanceof window.Node)e.appendChild(t);else if(t instanceof Array)for(var i=t.length,r=0;r<i;r++)n(e,t[r]);else o(e,t)}function o(e,t){for(var i in t)t.hasOwnProperty(i)&&("style"===i?r(e,t.style):e.setAttribute(i,t[i]))}function r(e,t){if(t){if("object"!=typeof t)return void(e.style.cssText=t);for(var i in t)t.hasOwnProperty(i)&&(e.style[i]=t[i])}}e.exports=i,e.exports.setAttributes=o},function(e,t){function i(e){var t=window.location.hash;if(""!==t){var i=t.indexOf("&"+e+"=")>0?t.indexOf("&"+e+"="):t.indexOf("#"+e+"=");if(i>=0){i+=e.length+2;var n=t.indexOf("&",i);return n>i?decodeURIComponent(t.substring(i,n)):n<0?decodeURIComponent(t.substring(i)):""}return!1}return!1}function n(e,t){var n=i(e),o=window.location.hash;if(n!==t)if("string"==typeof n){var r=o.indexOf("&"+e+"=")>0?o.indexOf("&"+e+"="):o.indexOf("#"+e+"="),a=r+e.length+2+n.length,s=0===r?"#":"&";window.location.replace(o.substring(0,r)+s+e+"="+t+o.substring(a))}else 0===o.length?window.location.replace("#"+e+"="+t):window.location.replace(o+"&"+e+"="+t)}e.exports.get=i,e.exports.update=n},function(e,t,i){var n=i(3),o=function(e){return function(){var t;e(document).on("click",function(t){i(e(t.target))});var i=function(i){var n,o,r=i.find(".diva-outer"),a=i.closest(".diva-outer"),s=document.getElementsByClassName("diva-outer"),l=s.length;if(r.length>0)n=r;else{if(!(a.length>0)){for(o=0;o<l;o++)e(s[o].parentElement.parentElement).data("diva").deactivate();return}n=a}for(n.parent().parent().data("diva").activate(),t=n.parent(),s=document.getElementsByClassName("diva-outer"),o=0;o<l;o++)s[o].getAttribute("id")!=n.attr("id")&&e(s[o].parentElement.parentElement).data("diva").deactivate()};this.getActive=function(){return t}}}(n);e.exports=o},function(e,t,i){function n(e,t){this.pages=e.pgs,this.maxZoom=e.max_zoom,this.maxRatio=e.dims.max_ratio,this.minRatio=e.dims.min_ratio,this.itemTitle=e.item_title,this.paged=!!e.paged,this._maxWidths=e.dims.max_w,this._maxHeights=e.dims.max_h,this._averageWidths=e.dims.a_wid,this._averageHeights=e.dims.a_hei,this._totalHeights=e.dims.t_hei,this._totalWidths=e.dims.t_wid,this._urlAdapter=t}function o(e){return function(t){return this[e][t]}}function r(e,t){return 1/Math.pow(2,e-t)}function a(){}function s(e){this._config=e}var l=i(12);e.exports=n,n.fromIIIF=function(e){var t=l(e);return new n(t,new a)},n.fromLegacyManifest=function(e,t){for(var i=0,o=e.pgs.length;i<o;i++)e.pgs[i].l=(i+1).toString();return new n(e,new s(t))},n.prototype.isPageValid=function(e,t){return!(!t&&this.paged&&!this.pages[e].paged)&&(e>=0&&e<this.pages.length)},n.prototype.getMaxPageDimensions=function(e){var t=this.pages[e].d[this.maxZoom];return{height:t.h,width:t.w}},n.prototype.getPageDimensionsAtZoomLevel=function(e,t){var i=this.pages[e].d[this.maxZoom],n=r(this.maxZoom,t);return{height:i.h*n,width:i.w*n}},n.prototype.getPageImageURL=function(e,t){return this._urlAdapter.getPageImageURL(this,e,t)},n.prototype.getPageImageTiles=function(e,t,i){var n=this.pages[e];if(!isFinite(t)||t%1!==0)throw new TypeError("Zoom level must be an integer: "+t);var o,r,a,s=Math.ceil(n.d[t].h/i.height),l=Math.ceil(n.d[t].w/i.width),c=[];for(o=0;o<s;o++)for(r=0;r<l;r++)a=this._urlAdapter.getTileImageURL(this,e,{row:o,col:r,rowCount:s,colCount:l,zoomLevel:t,tileDimensions:i}),c.push({row:o,col:r,zoomLevel:t,dimensions:{height:i.height,width:i.width},offset:{top:o*i.height,left:r*i.width},url:a});return{zoomLevel:t,rows:s,cols:l,tiles:c}},n.prototype.getMaxWidth=o("_maxWidths"),n.prototype.getMaxHeight=o("_maxHeights"),n.prototype.getAverageWidth=o("_averageWidths"),n.prototype.getAverageHeight=o("_averageHeights"),n.prototype.getTotalWidth=o("_totalWidths"),n.prototype.getTotalHeight=o("_totalHeights"),a.prototype.getPageImageURL=function(e,t,i){var n;n=!i||null==i.width&&null==i.height?"full":(null==i.width?"":i.width)+","+(null==i.height?"":i.height);var o=e.pages[t],r=o.api>1.1?"default":"native";return encodeURI(o.url+"full/"+n+"/0/"+r+".jpg")},a.prototype.getTileImageURL=function(e,t,i){var n,o,r=e.pages[t];n=i.row===i.rowCount-1?r.d[i.zoomLevel].h-(i.rowCount-1)*i.tileDimensions.height:i.tileDimensions.height,o=i.col===i.colCount-1?r.d[i.zoomLevel].w-(i.colCount-1)*i.tileDimensions.width:i.tileDimensions.width;var a=Math.pow(2,e.maxZoom-i.zoomLevel),s=i.col*i.tileDimensions.width*a,l=i.row*i.tileDimensions.height*a;r.hasOwnProperty("xoffset")&&(s+=r.xoffset,l+=r.yoffset);var c=[s,l,o*a,n*a].join(","),u=r.api>1.1?"default":"native";return encodeURI(r.url+c+"/"+o+","+n+"/0/"+u+".jpg")},s.prototype.getPageImageURL=function(e,t,i){var n="";i&&(null!=i.width&&(n+="&WID="+i.width),null!=i.height&&(n+="&HEI="+i.height));var o=e.pages[t].f;return this._config.iipServerURL+"?FIF="+this._config.imageDir+"/"+o+n+"&CVT=JPEG"},s.prototype.getTileImageURL=function(e,t,i){var n=e.pages[t],o=i.zoomLevel+n.m-e.maxZoom,r=i.row*i.colCount+i.col,a=o+","+r;return encodeURI(this._config.iipServerURL+"?FIF="+this._config.imageDir+"/"+n.f+"&JTL="+a+"&CVT=JPEG")}},function(e,t){function i(e){for(var t,i,o,r,a,s,l,c,u,h,d=function(e,t){return e/Math.pow(2,t)},g=function(e,t){var i=Math.max(e,t);return Math.ceil(Math.log((i+1)/257)/Math.log(2))},f=function(e,t){for(var i=new Array(e),n=e;n--;)i[n]=t;return i},p=e.sequences[0],v=p.canvases,m=[],w=[],y=0,b=e.label,_=0,P=v.length;_<P;_++){u=v[_].images[0].resource,t=u.width||v[_].width,i=u.height||v[_].height,a=n(u),o=a.url,r=o,"/"!==o.slice(-1)&&(o+="/"),s=g(t,i),l=v[_].label;var x="non-paged"!==v[_].viewingHint,I="facing-pages"===v[_].viewingHint;c=u.service["@context"],h="http://iiif.io/api/image/2/context.json"===c?2:"http://library.stanford.edu/iiif/image-api/1.1/context.json"===c?1.1:1,w[y]={mx_w:t,mx_h:i,mx_z:s,label:l,fn:r,url:o,api:h,paged:x,facingPages:I},a.hasOwnProperty("x")&&(w[y].xoffset=a.x,w[y].yoffset=a.y),m[y]=s,y++}var L,C,O,D=Math.min.apply(Math,m),T=0,k=100,S=f(D+1,0),E=f(D+1,0),M=f(D+1,0),z=f(D+1,0),j=[],A=w.length;for(_=0;_<A;_++){L=[];for(var R=0;R<D+1;R++){C=Math.floor(d(w[_].mx_w,D-R)),O=Math.floor(d(w[_].mx_h,D-R)),L[R]={h:O,w:C},S[R]+=C,E[R]+=O,M[R]=Math.max(C,M[R]),z[R]=Math.max(O,z[R]);var F=w[_].mx_h/w[_].mx_w;T=Math.max(F,T),k=Math.min(F,k)}j[_]={d:L,m:w[_].mx_z,l:w[_].label,f:w[_].fn,url:w[_].url,api:w[_].api,paged:w[_].paged,facingPages:w[_].facingPages},w[_].hasOwnProperty("xoffset")&&(j[_].xoffset=w[_].xoffset,j[_].yoffset=w[_].yoffset)}var V=[],Z=[];for(_=0;_<D+1;_++)V.push(S[_]/w.length),Z.push(E[_]/w.length);var H={a_wid:V,a_hei:Z,max_w:M,max_h:z,max_ratio:T,min_ratio:k,t_hei:E,t_wid:S},N={item_title:b,dims:H,max_zoom:D,pgs:j,paged:"paged"===e.viewingHint||"paged"===p.viewingHint};return N}function n(e){var t=e["@id"],i=/#xywh=([0-9]+,[0-9]+,[0-9]+,[0-9]+)/,n="",o=!0;if(/\/([0-9]+,[0-9]+,[0-9]+,[0-9]+)\//.test(t)){var r=t.split("/");n=r[r.length-4]}else if(i.test(t)){var a=i.exec(t);n=a[1]}else e.service&&e.service["@id"]&&(t=e.service["@id"],o=!1);o&&(t=t.split("/").slice(0,-4).join("/"));var s={url:t};if(n.length){var l=n.split(",");s.x=parseInt(l[0],10),s.y=parseInt(l[1],10),s.w=parseInt(l[2],10),s.h=parseInt(l[3],10)}return s}e.exports=i},function(e,t,i){function n(e){var t=e.getSettings(),i=function(e,i){var n={id:t.ID+e,"class":"diva-"+e};return i?o.extend(n,i):n},n=function(e,i){r.Events.subscribe(e,i,t.ID)},s=function(e,i,n){var o=a("button",{type:"button",id:t.ID+e,"class":"diva-"+e+" diva-button",title:i});return n&&o.addEventListener("click",n,!1),o},l=function(e){return function(){var i;switch(t[e.controllerSetting]){case"slider":i=e.createSlider();break;case"buttons":i=e.createButtons();break;default:return null}var o=a("span",i,e.createLabel()),r=function(){t.inGrid===e.showInGrid?o.style.display="inline":o.style.display="none"};return n("ViewDidSwitch",r),n("ObjectDidLoad",r),r(),o}},c=l({controllerSetting:"enableZoomControls",showInGrid:!1,createSlider:function(){var i=d("zoom-slider",{step:.1,value:t.zoomLevel,min:t.minZoomLevel,max:t.maxZoomLevel}),r=o(i);r.on("input",function(){var t=parseFloat(this.value);e.setZoomLevel(t)}),r.on("change",function(){var i=parseFloat(this.value);i!==t.zoomLevel&&e.setZoomLevel(i)});var s=function(){t.zoomLevel!==r.val()&&r.val(t.zoomLevel)};return n("ZoomLevelDidChange",s),n("ViewerDidLoad",function(){a.setAttributes(i,{min:t.minZoomLevel,max:t.maxZoomLevel}),s()}),i},createButtons:function(){return a("span",s("zoom-out-button","Zoom Out",function(){e.setZoomLevel(t.zoomLevel-1)}),s("zoom-in-button","Zoom In",function(){e.setZoomLevel(t.zoomLevel+1)}))},createLabel:function(){var e=g("diva-zoom-label","zoom-label","Zoom level: ","zoom-level",t.zoomLevel),i=o(e).find(t.selector+"zoom-level")[0],r=function(){i.textContent=t.zoomLevel.toFixed(2)};return n("ZoomLevelDidChange",r),n("ViewerDidLoad",r),e}}),u=l({controllerSetting:"enableGridControls",showInGrid:!0,createSlider:function(){var i=d("grid-slider",{value:t.pagesPerRow,min:t.minPagesPerRow,max:t.maxPagesPerRow}),r=o(i);return r.on("input",function(){var t=parseInt(i.value,10);e.setGridPagesPerRow(t)}),r.on("change",function(){var n=parseInt(i.value,10);n!==t.pagesPerRow&&e.setGridPagesPerRow(n)}),n("GridRowNumberDidChange",function(){t.pagesPerRow!==r.val()&&r.val(t.pagesPerRow)}),i},createButtons:function(){return a("span",s("grid-out-button","Zoom Out",function(){e.setGridPagesPerRow(t.pagesPerRow-1)}),s("grid-in-button","Zoom In",function(){e.setGridPagesPerRow(t.pagesPerRow+1)}))},createLabel:function(){var e=g("diva-grid-label","grid-label","Pages per row: ","pages-per-row",t.pagesPerRow),i=o(e).find(t.selector+"pages-per-row")[0];return n("GridRowNumberDidChange",function(){i.textContent=t.pagesPerRow}),e}}),h=function(){var r=a("div",i("view-options")),l=s("view-icon","Change view",function(){o(r).toggle()});o(document).mouseup(function(e){var i=o(r);i.is(e.target)||0!==i.has(e.target).length||e.target.id===t.ID+"view-icon"||i.hide()});var c=function(t){e.changeView(t),o(r).hide()},u=function(){var e=" diva-view-icon diva-button";t.inGrid?l.className="diva-grid-icon"+e:t.inBookLayout?l.className="diva-book-icon"+e:l.className="diva-document-icon"+e;var i=document.createDocumentFragment();for((t.inGrid||t.inBookLayout)&&i.appendChild(s("document-icon","Document View",c.bind(null,"document"))),!t.inGrid&&t.inBookLayout||i.appendChild(s("book-icon","Book View",c.bind(null,"book"))),t.inGrid||i.appendChild(s("grid-icon","Grid View",c.bind(null,"grid")));r.firstChild;)r.removeChild(r.firstChild);r.appendChild(i)};return n("ViewDidSwitch",u),n("ObjectDidLoad",u),a("div",i("view-menu"),l,r)},d=function(e,i){return a("input",i,{id:t.ID+e,"class":"diva-"+e+" diva-slider",type:"range"})},g=function(e,i,n,o,r){return a("div",{id:t.ID+i,"class":e+" diva-label"},[n,a("span",{id:t.ID+o},r)])},f=function(){var e=t.enableGotoPage?p():null;return a("span",i("page-nav"),v(),e)},p=function(){var i=a("input",{id:t.ID+"goto-page-input","class":"diva-input diva-goto-page-input",autocomplete:"off",type:"text"}),n=a("input",{id:t.ID+"goto-page-submit","class":"diva-button diva-button-text",type:"submit",value:"Go"}),r=a("div",{id:t.ID+"input-suggestions","class":"diva-input-suggestions"}),s=a("form",{id:t.ID+"goto-page","class":"diva-goto-form"},i,n,r);return o(s).on("submit",function(){var n=i.value;if(t.onGotoSubmit&&"function"==typeof t.onGotoSubmit){var o=t.onGotoSubmit(n);e.gotoPageByIndex(o)||alert("No page could be found with that label or page number")}else e.gotoPageByLabel(n)||alert("No page could be found with that label or page number");return r.style.display="none",!1}),o(i).on("input focus",function(){r.innerHTML="";var e=i.value,n=0;if(t.enableGotoSuggestions&&e){for(var o=t.manifest.pages,s=0,l=o.length;s<l&&n<10;s++)if(o[s].l.toLowerCase().indexOf(e.toLowerCase())>-1){var c=a("div",{"class":"diva-input-suggestion"},o[s].l);r.appendChild(c),n++}n>0&&(r.style.display="block")}else r.style.display="none"}),o(i).on("keydown",function(e){var t;if(13===e.keyCode){var n=o(".active",r);n.length&&(i.value=n.text())}if(38===e.keyCode){t=o(".active",r);var a=t.prev();a.length?(t.removeClass("active"),a.addClass("active")):(t.removeClass("active"),o(".diva-input-suggestion:last",r).addClass("active"))}else if(40===e.keyCode){t=o(".active",r);var s=t.next();s.length?(t.removeClass("active"),s.addClass("active")):(t.removeClass("active"),o(".diva-input-suggestion:first",r).addClass("active"))}}),o(r).on("mousedown",".diva-input-suggestion",function(){i.value=this.textContent,r.style.display="none",o(i).trigger("submit")}),o(i).on("blur",function(){r.style.display="none"}),s},v=function(){var i=a("span",{id:t.ID+"current-page"}),o=function(){i.textContent=e.getCurrentAliasedPageIndex()};n("VisiblePageDidChange",o),n("ViewerDidLoad",o);var r=a("span",{id:t.ID+"num-pages"}),s=function(){r.textContent=t.numPages};return n("NumberOfPagesDidChange",s),n("ObjectDidLoad",s),a("span",{"class":"diva-page-label diva-label"},"Page ",i," of ",r)},m=function(){var e=[h()];return t.enableLinkIcon&&e.push(w()),t.enableNonPagedVisibilityIcon&&e.push(b()),t.enableFullscreen&&e.push(y()),a("span",i("toolbar-button-group"),e)},w=function(){var i=s("link-icon","Link to this page"),n=o(i);return n.on("click",function(){if(o("body").prepend(a("div",{id:t.ID+"link-popup","class":"diva-popup diva-link-popup"},[a("input",{id:t.ID+"link-popup-input","class":"diva-input",type:"text",value:e.getCurrentURL()})])),t.inFullscreen)o(t.selector+"link-popup").addClass("in-fullscreen");else{var i=n.offset().left-222+n.outerWidth(),r=n.offset().top+n.outerHeight()-1;o(t.selector+"link-popup").css({top:r+"px",left:i+"px"})}return o("body").mouseup(function(e){var i=e.target.id;i!==t.ID+"link-popup"&&i!==t.ID+"link-popup-input"&&o(t.selector+"link-popup").remove()}),t.viewportObject.scroll(function(){o(t.selector+"link-popup").remove()}),o(t.selector+"link-popup input").click(function(){o(this).focus().select()}),!1}),i},y=function(){return s("fullscreen-icon","Toggle fullscreen mode",function(){e.toggleFullscreenMode()})},b=function(){var i=function(){return"toggle-nonpaged-icon"+(e.getSettings().showNonPagedPages?"-active":"")},o=s(i(),"Toggle visibility of non-paged pages",function(){e.toggleNonPagedPagesVisibility();var t="diva-"+i();
this.className=this.className.replace(/diva-toggle-nonpaged-icon(-active)?/,t)}),r=function(){for(var e=t.manifest.pages,i=0;i<e.length;i++)if(t.manifest.paged&&!e[i].paged)return void(o.style.display="inline-block");o.style.display="none"};return n("ObjectDidLoad",r),o},_=function(){var e=[c(),u()],r=[f(),m()],s=a("div",i("tools"),a("div",i("tools-left"),e),a("div",i("tools-right"),r));t.toolbarParentObject.prepend(s);var l=function(){var e=document.getElementById(t.ID+"tools-right"),i=document.getElementById(t.ID+"page-nav");t.inFullscreen?(o(s).addClass("diva-fullscreen-tools"),e.removeChild(i),e.appendChild(i)):(o(s).removeClass("diva-fullscreen-tools"),e.removeChild(i),e.insertBefore(i,e.firstChild))};n("ModeDidSwitch",l),n("ViewerDidLoad",l);var h={element:s,closePopups:function(){o(".diva-popup").css("display","none")}};return h};return _()}var o=i(3),r=i(2),a=i(8);e.exports=n},function(e,t,i){function n(e,t,i){var n=this,_=r(e),P={currentPageIndex:0,horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerElement:null,innerObject:{},isActiveDiva:!0,isIIIF:!1,isScrollable:!0,isZooming:!1,loaded:!1,manifest:null,mobileWebkit:!1,numPages:0,oldZoomLevel:-1,options:t,outerElement:null,outerObject:{},pageOverlays:new d,pageTools:[],parentObject:_,pendingManifestRequest:null,plugins:[],renderer:null,resizeTimer:-1,scrollbarWidth:0,selector:"",throbberTimeoutID:-1,toolbar:null,verticalOffset:0,verticalPadding:0,viewHandler:null,viewport:null,viewportElement:null,viewportObject:null},x=v([t,P]);Object.defineProperties(x,{panelHeight:{get:function(){return P.viewport.height}},panelWidth:{get:function(){return P.viewport.width}}});var I=new m({additionalProperties:[{key:"manifest",get:function(){return P.manifest}}],validations:b}),L=function(e,t){return I.isValid(e,t,P.options)},C=function(e,t){var i={id:x.ID+e,"class":"diva-"+e};return t?r.extend(i,t):i},O=function(e,t){return x.manifest.pages[e].d[x.zoomLevel][t]},D=function(){P.viewport.top=0,clearTimeout(P.resizeTimer)},T=function(e){var t=[];if(e=I.getValidatedOptions(x,e),k(e,"zoomLevel")&&(P.oldZoomLevel=x.zoomLevel,P.options.zoomLevel=e.zoomLevel,t.push(["ZoomLevelDidChange",e.zoomLevel])),k(e,"pagesPerRow")&&(P.options.pagesPerRow=e.pagesPerRow,t.push(["GridRowNumberDidChange",e.pagesPerRow])),k(e,"verticallyOriented")&&(P.options.verticallyOriented=e.verticallyOriented),k(e,"showNonPagedPages")&&(P.options.showNonPagedPages=e.showNonPagedPages),"goDirectlyTo"in e?(P.options.goDirectlyTo=e.goDirectlyTo,"verticalOffset"in e&&(P.verticalOffset=e.verticalOffset),"horizontalOffset"in e&&(P.horizontalOffset=e.horizontalOffset)):P.options.goDirectlyTo=x.currentPageIndex,(k(e,"inGrid")||k(e,"inBookLayout"))&&("inGrid"in e&&(P.options.inGrid=e.inGrid),"inBookLayout"in e&&(P.options.inBookLayout=e.inBookLayout),t.push(["ViewDidSwitch",x.inGrid])),k(e,"inFullscreen")&&(P.options.inFullscreen=e.inFullscreen,S(e),t.push(["ModeDidSwitch",x.inFullscreen])),D(),E(),P.renderer){var i={pageLayouts:p(x),padding:j(),maxZoomLevel:x.inGrid?null:P.manifest.maxZoom,verticallyOriented:x.verticallyOriented||x.inGrid},n={zoomLevel:x.inGrid?null:x.zoomLevel,anchorPage:x.goDirectlyTo,verticalOffset:P.verticalOffset,horizontalOffset:P.horizontalOffset},o=z();if(y.enabled){var r=Object.keys(i).filter(function(e){return"pageLayouts"!==e&&"padding"!==e}).map(function(e){var t=i[e];return e+": "+JSON.stringify(t)}).join(", ");y("reload with %s",r)}P.renderer.load(i,n,o)}return t.forEach(function(e){Q.apply(null,e)}),!0},k=function(e,t){return t in e&&e[t]!==x[t]},S=function(e){var t=e.inFullscreen?"addClass":"removeClass";P.outerObject[t]("diva-fullscreen"),r("body")[t]("diva-hide-scrollbar"),x.parentObject[t]("diva-full-width");var i=x.panelHeight,n=x.panelWidth;if(P.viewport.invalidate(),!(P.loaded||x.inGrid||"verticalOffset"in e)){var o=x.panelHeight,a=x.panelWidth;P.verticalOffset+=(i-o)/2,P.horizontalOffset+=(n-a)/2}e.inFullscreen?r(document).on("keyup",R):r(document).off("keyup",R)},E=function(){var e=x.inGrid?h:u;!P.viewHandler||P.viewHandler instanceof e||(P.viewHandler.destroy(),P.viewHandler=null),P.viewHandler||(P.viewHandler=new e(n)),P.renderer||M()},M=function(){var e=f.getCompatibilityErrors();if(e)K(e);else{var t={viewport:P.viewport,outerElement:P.outerElement,innerElement:P.innerElement},i={onViewWillLoad:function(){P.viewHandler.onViewWillLoad()},onViewDidLoad:function(){A(),P.viewHandler.onViewDidLoad()},onViewDidUpdate:function(e,t){A(),P.viewHandler.onViewDidUpdate(e,t)},onViewDidTransition:function(){A()},onPageWillLoad:function(e){Q("PageWillLoad",e)}};P.renderer=new f(t,i)}},z=function(){if(x.inGrid){var e={getAllZoomLevelsForPage:function(t){return[e.getBestZoomLevelForPage(t)]},getBestZoomLevelForPage:function(e){var t=x.manifest.getPageImageURL(e.index,{width:e.dimensions.width});return{zoomLevel:1,rows:1,cols:1,tiles:[{url:t,zoomLevel:1,row:0,col:0,dimensions:e.dimensions,offset:{top:0,left:0}}]}}};return e}var t={width:x.tileWidth,height:x.tileHeight};return{getBestZoomLevelForPage:function(e){return x.manifest.getPageImageTiles(e.index,Math.ceil(x.zoomLevel),t)},getAllZoomLevelsForPage:function(e){for(var i=[],n=P.manifest.maxZoom,o=0;o<=n;o++)i.push(x.manifest.getPageImageTiles(e.index,o,t));return i.reverse(),i}}},j=function(){var e,t,i,n;return x.inGrid?(i=x.fixedPadding,e=t=n=0):(e=x.verticallyOriented?P.verticalPadding:0,t=x.verticallyOriented?0:P.horizontalPadding,i=x.verticallyOriented?0:P.verticalPadding,n=x.verticallyOriented?P.horizontalPadding:0),{document:{top:i,bottom:i,left:n,right:n},page:{top:e,bottom:0,left:t,right:0}}},A=function(){P.pageOverlays.updateOverlays(P.renderer.getRenderedPages())},R=function(e){27==e.keyCode&&T({inFullscreen:!x.inFullscreen})},F=function(e,t){function i(e){var i=Math.pow(2,e-l),n=t.offset.left*i-a,o=t.offset.top*i-s;return{zoomLevel:e,anchorPage:t.anchorPage,verticalOffset:o,horizontalOffset:n}}if(!L("zoomLevel",e))return!1;if(null==t){var n=P.viewport,o=P.renderer.layout.getPageRegion(x.currentPageIndex);t={anchorPage:x.currentPageIndex,offset:{left:n.width/2-(o.left-n.left),top:n.height/2-(o.top-n.top)}}}var r=P.renderer.layout.getPageRegion(t.anchorPage),a=r.left+t.offset.left-(x.viewport.left+x.viewport.width/2),s=r.top+t.offset.top-(x.viewport.top+x.viewport.height/2),l=P.oldZoomLevel=x.zoomLevel;P.options.zoomLevel=e;var c=i(e);return P.options.goDirectlyTo=c.anchorPage,P.verticalOffset=c.verticalOffset,P.horizontalOffset=c.horizontalOffset,P.renderer.transitionViewportPosition({duration:300,parameters:{zoomLevel:{from:l,to:e}},getPosition:function(e){return i(e.zoomLevel)},onEnd:function(t){P.viewportObject.scroll(Y),t.interrupted&&(P.oldZoomLevel=e)}}),Q("ZoomLevelDidChange",e),P.viewportObject.off("scroll"),!0},V=function(e,t){return e="undefined"==typeof e?x.currentPageIndex:e,"center"===t||"centre"===t?parseInt(O(e,"h")/2,10):"bottom"===t?parseInt(O(e,"h")-x.panelHeight/2,10):parseInt(x.panelHeight/2,10)},Z=function(e,t){return e="undefined"==typeof e?x.currentPageIndex:e,"left"===t?parseInt(x.panelWidth/2,10):"right"===t?parseInt(O(e,"w")-x.panelWidth/2,10):parseInt(O(e,"w")/2,10)},H=function(){return P.viewport.invalidate(),P.renderer&&(N(),P.renderer["goto"](x.currentPageIndex,P.verticalOffset,P.horizontalOffset)),!0},N=function(){var e=P.renderer.layout.getPageToViewportCenterOffset(x.currentPageIndex,P.viewport);e&&(P.horizontalOffset=e.x,P.verticalOffset=e.y)},G=function(){P.viewportObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0}),P.innerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0}),l.onDoubleClick(P.viewportObject,function(e,t){y("Double click at %s, %s",t.left,t.top),P.viewHandler.onDoubleClick(e,t)})},B=function(){H(),clearTimeout(P.resizeTimer),P.resizeTimer=setTimeout(function(){var e=P.renderer.layout.getPageToViewportCenterOffset(x.currentPageIndex,P.viewport);T(e?{goDirectlyTo:x.currentPageIndex,verticalOffset:e.y,horizontalOffset:e.x}:{goDirectlyTo:x.currentPageIndex})},200)},W=function(){x.blockMobileMove&&r("body").bind("touchmove",function(e){var t=e.originalEvent;return t.preventDefault(),!1}),P.viewportObject.kinetic({triggerHardware:!0}),l.onPinch(P.viewportObject,function(e,t,i,n){y("Pinch %s at %s, %s",n-i,t.left,t.top),P.viewHandler.onPinch(e,t,i,n)}),l.onDoubleTap(P.viewportObject,function(e,t){y("Double tap at %s, %s",t.left,t.top),P.viewHandler.onDoubleClick(e,t)})},Y=function(){var e,t=P.viewport.top,i=P.viewport.left;P.viewport.invalidate();var n=P.viewport.top,o=P.viewport.left;e=x.verticallyOriented||x.inGrid?n-t:o-i,P.renderer.adjust(e);var r=x.verticallyOriented||x.inGrid?n:o;Q("ViewerDidScroll",r),e>0?Q("ViewerDidScrollDown",r):e<0&&Q("ViewerDidScrollUp",r),N()},U=function(){P.innerObject.mousedown(function(){P.innerObject.addClass("diva-grabbing")}),P.innerObject.mouseup(function(){P.innerObject.removeClass("diva-grabbing")}),G(),P.viewportObject.scroll(Y);var e=38,t=40,i=37,n=39,o=32,a=33,s=34,l=36,u=35;r(document).on("keydown.diva",function(r){if(!P.isActiveDiva)return!0;if(x.enableSpaceScroll&&!r.shiftKey&&r.keyCode===o||x.enableKeyScroll&&r.keyCode===s)return P.viewport.top+=x.panelHeight,!1;if(x.enableSpaceScroll||r.keyCode!==o||r.preventDefault(),x.enableKeyScroll){if(r.shiftKey||r.ctrlKey||r.metaKey)return!0;switch(r.keyCode){case a:return P.viewport.top-=x.panelHeight,!1;case e:return P.viewport.top-=x.arrowScrollAmount,!1;case t:return P.viewport.top+=x.arrowScrollAmount,!1;case i:return P.viewport.left-=x.arrowScrollAmount,!1;case n:return P.viewport.left+=x.arrowScrollAmount,!1;case l:return P.viewport.top=0,!1;case u:return x.verticallyOriented?P.viewport.top=1/0:P.viewport.left=1/0,!1;default:return!0}}return!0}),c.Events.subscribe("ViewerDidTerminate",function(){r(document).off("keydown.diva")},x.ID),W(),window.addEventListener("resize",B,!1),c.Events.subscribe("ViewerDidTerminate",function(){window.removeEventListener("resize",B,!1)},x.ID),"onorientationchange"in window&&(window.addEventListener("orientationchange",B,!1),c.Events.subscribe("ViewerDidTerminate",function(){window.removeEventListener("orientationchange",B,!1)},x.ID)),c.Events.subscribe("PanelSizeDidChange",H,x.ID),c.Events.subscribe("ViewerDidTerminate",function(){P.renderer&&P.renderer.destroy(),clearTimeout(P.resizeTimer)},x.ID)},q=function(){g.getAll().forEach(function(e){var t=e.pluginName[0].toUpperCase()+e.pluginName.substring(1);if(x["enable"+t]){var n=e.init(x,i);if(!n)return;"function"==typeof e.handleClick&&P.pageTools.push(e),x.plugins.push(e)}})},X=function(){$(),P.throbberTimeoutID=setTimeout(function(){r(x.selector+"throbber").show()},x.throbberTimeout)},$=function(){clearTimeout(P.throbberTimeoutID),r(x.selector+"throbber").hide()},K=function(e){var t=a("div",C("error"),[a("button",C("error-close",{"aria-label":"Close dialog"})),a("p",a("strong","Error")),a("div",e)]);P.outerObject.append(t),r(x.selector+"error-close").on("click",function(){t.parentNode.removeChild(t)})},J=function(e,t,i){if(P.manifest=e,P.isIIIF=t,$(),P.numPages=x.manifest.pages.length,I.validate(P.options),Q("NumberOfPagesDidChange",x.numPages),x.enableAutoTitle&&(r(x.selector+"title").length?r(x.selector+"title").html(x.manifest.itemTitle):x.parentObject.prepend(a("div",C("title"),[x.manifest.itemTitle]))),x.adaptivePadding>0){var n=Math.floor((x.minZoomLevel+x.maxZoomLevel)/2);P.horizontalPadding=parseInt(x.manifest.getAverageWidth(n)*x.adaptivePadding,10),P.verticalPadding=parseInt(x.manifest.getAverageHeight(n)*x.adaptivePadding,10)}else P.horizontalPadding=x.fixedPadding,P.verticalPadding=x.fixedPadding;P.pageTools.length&&(P.verticalPadding=Math.max(40,P.verticalPadding)),x.manifest.paged&&(P.options.inBookLayout=!0),Q("ObjectDidLoad",x),H();var o,s,l=!1,c=!1;null==i.goDirectlyTo?(i.goDirectlyTo=x.goDirectlyTo,o=s=!0):(o=null==i.horizontalOffset||isNaN(i.horizontalOffset),s=null==i.verticalOffset||isNaN(i.verticalOffset)),o&&(0===i.goDirectlyTo&&x.inBookLayout&&x.verticallyOriented?i.horizontalOffset=P.horizontalPadding:(c=!0,i.horizontalOffset=Z(i.goDirectlyTo,"center"))),s&&(l=!0,i.verticalOffset=V(i.goDirectlyTo,"top")),T(i),H(),x.verticallyOriented?P.innerElement.style.minWidth=x.panelWidth+"px":P.innerElement.style.minHeight=x.panelHeight+"px",(l||c)&&(l&&(P.verticalOffset=V(x.currentPageIndex,"top")),c&&(P.horizontalOffset=Z(x.currentPageIndex,"center")),P.renderer["goto"](x.currentPageIndex,P.verticalOffset,P.horizontalOffset)),P.loaded=!0,Q("ViewerDidLoad",x)},Q=function(e){var t=Array.prototype.slice.call(arguments,1);c.Events.publish(e,t,i)},ee=function(){P.scrollbarWidth=s(),P.mobileWebkit=void 0!==window.orientation;var e=o();P.ID="diva-"+e+"-",P.selector="#"+x.ID,null===t.hashParamSuffix&&(1===e?t.hashParamSuffix="":t.hashParamSuffix=e+"");var i=a("div",C("inner",{"class":"diva-inner diva-dragger"})),n=a("div",C("viewport"),i),l=a("div",C("outer"),n,a("div",C("throbber")));P.innerElement=i,P.viewportElement=n,P.outerElement=l,P.innerObject=r(i),P.viewportObject=r(n),P.outerObject=r(l),x.parentObject.append(l),P.viewport=new w(P.viewportElement,{intersectionTolerance:x.viewportMargin}),q(),U(),X()};this.getSettings=function(){return x},this.getInternalState=function(){return P},this.getPublicInstance=function(){return i},this.getPageTools=function(){return P.pageTools},this.getCurrentLayout=function(){return P.renderer?P.renderer.layout:null},this.getViewport=function(){var e=P.viewport;return{top:e.top,left:e.left,bottom:e.bottom,right:e.right,width:e.width,height:e.height}},this.addPageOverlay=function(e){P.pageOverlays.addOverlay(e)},this.removePageOverlay=function(e){P.pageOverlays.removeOverlay(e)},this.getPageRegion=function(e,t){var i=P.renderer.layout,n=i.getPageRegion(e,t);if(t&&t.incorporateViewport){var o=x.verticallyOriented?"width":"height";if(P.viewport[o]>i.dimensions[o]){var r=(P.viewport[o]-i.dimensions[o])/2;return x.verticallyOriented?{top:n.top,bottom:n.bottom,left:n.left+r,right:n.right+r}:{top:n.top+r,bottom:n.bottom+r,left:n.left,right:n.right}}}return n},this.getPagePositionAtViewportOffset=function(e){for(var t={left:e.left+P.viewport.left,top:e.top+P.viewport.top},i=P.renderer.getRenderedPages(),n=i.length,o=0;o<n;o++){var r=i[o],a=P.renderer.layout.getPageRegion(r);if(a.left<=t.left&&a.right>=t.left&&a.top<=t.top&&a.bottom>=t.top)return{anchorPage:r,offset:{left:t.left-a.left,top:t.top-a.top}}}var s=P.renderer.layout.getPageRegion(x.currentPageIndex);return{anchorPage:x.currentPageIndex,offset:{left:t.left-s.left,top:t.top-s.top}}},this.setManifest=function(e,t,i){J(e,t,i||{})},this.setCurrentPage=function(e){P.currentPageIndex!==e&&(P.currentPageIndex=e,Q("VisiblePageDidChange",e,this.getPageName(e)))},this.getPageName=function(e){return P.manifest.pages[e].f},this.reload=function(e){T(e)},this.zoom=function(e,t){return F(e,t)},this.enableScrollable=function(){P.isScrollable||(G(),P.options.enableKeyScroll=P.initialKeyScroll,P.options.enableSpaceScroll=P.initialSpaceScroll,P.viewportElement.style.overflow="auto",P.isScrollable=!0)},this.disableScrollable=function(){P.isScrollable&&(P.innerObject.hasClass("diva-dragger")&&P.innerObject.unbind("mousedown"),P.outerObject.unbind("dblclick"),P.outerObject.unbind("contextmenu"),P.viewportElement.style.overflow="hidden",P.initialKeyScroll=x.enableKeyScroll,P.initialSpaceScroll=x.enableSpaceScroll,P.options.enableKeyScroll=!1,P.options.enableSpaceScroll=!1,P.isScrollable=!1)},this.isValidOption=function(e,t){return L(e,t)},this.showError=function(e){$();var t=a("div",C("error"),[a("button",C("error-close",{"aria-label":"Close dialog"})),a("p",a("strong","Error")),a("div",e)]);P.outerObject.append(t),r(x.selector+"error-close").on("click",function(){t.parentNode.removeChild(t)})},this.getXOffset=function(e,t){return Z(e,t)},this.getYOffset=function(e,t){return V(e,t)},this.publish=Q,this.clear=function(){D()},this.setPendingManifestRequest=function(e){P.pendingManifestRequest=e},this.destroy=function(){Q("ViewerWillTerminate",x),x.pendingManifestRequest&&x.pendingManifestRequest.abort(),r("body").removeClass("diva-hide-scrollbar"),x.parentObject.parent().empty().removeData("diva"),x.parentObject.parent().removeAttr("style").removeAttr("class"),Q("ViewerDidTerminate",x),c.Events.unsubscribeAll(x.ID)},ee()}function o(){return o.counter++}var r=i(3);i(15);var a=i(8),s=i(16),l=i(17),c=i(2),u=i(18),h=i(22),d=i(23),g=i(5),f=i(24),p=i(33),v=i(38),m=i(39),w=i(40),y=i(25)("diva:ViewerCore");e.exports=n;var b=[{key:"goDirectlyTo",validate:function(e,t){if(e<0||e>=t.manifest.pages.length)return 0}},{key:"minPagesPerRow",validate:function(e){return Math.max(2,e)}},{key:"maxPagesPerRow",validate:function(e,t){return Math.max(e,t.minPagesPerRow)}},{key:"pagesPerRow",validate:function(e,t){if(e<t.minPagesPerRow||e>t.maxPagesPerRow)return t.maxPagesPerRow}},{key:"maxZoomLevel",validate:function(e,t,i){if(i.suppressWarning(),e<0||e>t.manifest.maxZoom)return t.manifest.maxZoom}},{key:"minZoomLevel",validate:function(e,t,i){return e>t.manifest.maxZoom?(i.suppressWarning(),0):e<0||e>t.maxZoomLevel?0:void 0}},{key:"zoomLevel",validate:function(e,t,i){return e>t.manifest.maxZoom?(i.suppressWarning(),0):e<t.minZoomLevel||e>t.maxZoomLevel?t.minZoomLevel:void 0}}];o.counter=1},function(e,t,i){var n=i(3);!function(e){e.fn.dragscrollable=function(t){var i=e.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},t||{}),n={mouseDownHandler:function(t){return!(1!=t.which||!t.data.acceptPropagatedEvent&&t.target!=this)&&(t.data.lastCoord={left:t.clientX,top:t.clientY},e.event.add(document,"mouseup",n.mouseUpHandler,t.data),e.event.add(document,"mousemove",n.mouseMoveHandler,t.data),t.data.preventDefault?(t.preventDefault(),!1):void 0)},mouseMoveHandler:function(e){var t={left:e.clientX-e.data.lastCoord.left,top:e.clientY-e.data.lastCoord.top};if(e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-t.left),e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-t.top),e.data.lastCoord={left:e.clientX,top:e.clientY},e.data.preventDefault)return e.preventDefault(),!1},mouseUpHandler:function(t){if(e.event.remove(document,"mousemove",n.mouseMoveHandler),e.event.remove(document,"mouseup",n.mouseUpHandler),t.data.preventDefault)return t.preventDefault(),!1}};this.each(function(){var t={scrollable:e(this),acceptPropagatedEvent:i.acceptPropagatedEvent,preventDefault:i.preventDefault};e(this).find(i.dragSelector).bind("mousedown",t,n.mouseDownHandler)})}}(n),/**
	 jQuery.kinetic v2.2.1
	 Dave Taylor http://davetayls.me
	
	 @license The MIT License (MIT)
	 @preserve Copyright (c) 2012 Dave Taylor http://davetayls.me
	 */
function(e){"use strict";var t="kinetic-active";window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),e.support=e.support||{},e.extend(e.support,{touch:"ontouchend"in document});var i=function(t,i){return this.settings=i,this.el=t,this.$el=e(t),this._initElements(),this};i.DATA_KEY="kinetic",i.DEFAULTS={cursor:"move",decelerate:!0,triggerHardware:!1,threshold:0,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,invert:!1,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},i.prototype.start=function(t){this.settings=e.extend(this.settings,t),this.velocity=t.velocity||this.velocity,this.velocityY=t.velocityY||this.velocityY,this.settings.decelerate=!1,this._move()},i.prototype.end=function(){this.settings.decelerate=!0},i.prototype.stop=function(){this.velocity=0,this.velocityY=0,this.settings.decelerate=!0,e.isFunction(this.settings.stopped)&&this.settings.stopped.call(this)},i.prototype.detach=function(){this._detachListeners(),this.$el.removeClass(t).css("cursor","")},i.prototype.attach=function(){this.$el.hasClass(t)||(this._attachListeners(this.$el),this.$el.addClass(t).css("cursor",this.settings.cursor))},i.prototype._initElements=function(){this.$el.addClass(t),e.extend(this,{xpos:null,prevXPos:!1,ypos:null,prevYPos:!1,mouseDown:!1,throttleTimeout:1e3/this.settings.throttleFPS,lastMove:null,elementFocused:null}),this.velocity=0,this.velocityY=0,e(document).mouseup(e.proxy(this._resetMouse,this)).click(e.proxy(this._resetMouse,this)),this._initEvents(),this.$el.css("cursor",this.settings.cursor),this.settings.triggerHardware&&this.$el.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})},i.prototype._initEvents=function(){var t=this;this.settings.events={touchStart:function(e){var i;t._useTarget(e.target,e)&&(i=e.originalEvent.touches[0],t.threshold=t._threshold(e.target,e),t._start(i.clientX,i.clientY),e.stopPropagation())},touchMove:function(e){var i;t.mouseDown&&(i=e.originalEvent.touches[0],t._inputmove(i.clientX,i.clientY),e.preventDefault&&e.preventDefault())},inputDown:function(e){t._useTarget(e.target,e)&&(t.threshold=t._threshold(e.target,e),t._start(e.clientX,e.clientY),t.elementFocused=e.target,"IMG"===e.target.nodeName&&e.preventDefault(),e.stopPropagation())},inputEnd:function(e){t._useTarget(e.target,e)&&(t._end(),t.elementFocused=null,e.preventDefault&&e.preventDefault())},inputMove:function(e){t.mouseDown&&(t._inputmove(e.clientX,e.clientY),e.preventDefault&&e.preventDefault())},scroll:function(i){e.isFunction(t.settings.moved)&&t.settings.moved.call(t,t.settings),i.preventDefault&&i.preventDefault()},inputClick:function(e){if(Math.abs(t.velocity)>0)return e.preventDefault(),!1},dragStart:function(e){if(t._useTarget(e.target,e)&&t.elementFocused)return!1},selectStart:function(i){return e.isFunction(t.settings.selectStart)?t.settings.selectStart.apply(t,arguments):!t._useTarget(i.target,i)&&void 0}},this._attachListeners(this.$el,this.settings)},i.prototype._inputmove=function(t,i){var n=this.$el;this.el;if((!this.lastMove||new Date>new Date(this.lastMove.getTime()+this.throttleTimeout))&&(this.lastMove=new Date,this.mouseDown&&(this.xpos||this.ypos))){var o=t-this.xpos,r=i-this.ypos;if(this.settings.invert&&(o*=-1,r*=-1),this.threshold>0){var a=Math.sqrt(o*o+r*r);if(this.threshold>a)return;this.threshold=0}this.elementFocused&&(e(this.elementFocused).blur(),this.elementFocused=null,n.focus()),this.settings.decelerate=!1,this.velocity=this.velocityY=0;var s=this.scrollLeft(),l=this.scrollTop();this.scrollLeft(this.settings.x?s-o:s),this.scrollTop(this.settings.y?l-r:l),this.prevXPos=this.xpos,this.prevYPos=this.ypos,this.xpos=t,this.ypos=i,this._calculateVelocities(),this._setMoveClasses(this.settings.movingClass),e.isFunction(this.settings.moved)&&this.settings.moved.call(this,this.settings)}},i.prototype._calculateVelocities=function(){this.velocity=this._capVelocity(this.prevXPos-this.xpos,this.settings.maxvelocity),this.velocityY=this._capVelocity(this.prevYPos-this.ypos,this.settings.maxvelocity),this.settings.invert&&(this.velocity*=-1,this.velocityY*=-1)},i.prototype._end=function(){this.xpos&&this.prevXPos&&this.settings.decelerate===!1&&(this.settings.decelerate=!0,this._calculateVelocities(),this.xpos=this.prevXPos=this.mouseDown=!1,this._move())},i.prototype._useTarget=function(t,i){return!e.isFunction(this.settings.filterTarget)||this.settings.filterTarget.call(this,t,i)!==!1},i.prototype._threshold=function(t,i){return e.isFunction(this.settings.threshold)?this.settings.threshold.call(this,t,i):this.settings.threshold},i.prototype._start=function(e,t){this.mouseDown=!0,this.velocity=this.prevXPos=0,this.velocityY=this.prevYPos=0,this.xpos=e,this.ypos=t},i.prototype._resetMouse=function(){this.xpos=!1,this.ypos=!1,this.mouseDown=!1},i.prototype._decelerateVelocity=function(e,t){return 0===Math.floor(Math.abs(e))?0:e*t},i.prototype._capVelocity=function(e,t){var i=e;return e>0?e>t&&(i=t):e<0-t&&(i=0-t),i},i.prototype._setMoveClasses=function(e){var t=this.settings,i=this.$el;i.removeClass(t.movingClass.up).removeClass(t.movingClass.down).removeClass(t.movingClass.left).removeClass(t.movingClass.right).removeClass(t.deceleratingClass.up).removeClass(t.deceleratingClass.down).removeClass(t.deceleratingClass.left).removeClass(t.deceleratingClass.right),this.velocity>0&&i.addClass(e.right),this.velocity<0&&i.addClass(e.left),this.velocityY>0&&i.addClass(e.down),this.velocityY<0&&i.addClass(e.up)},i.prototype._move=function(){var t=this._getScroller(),i=t[0],n=this,o=n.settings;o.x&&i.scrollWidth>0?(this.scrollLeft(this.scrollLeft()+this.velocity),Math.abs(this.velocity)>0&&(this.velocity=o.decelerate?n._decelerateVelocity(this.velocity,o.slowdown):this.velocity)):this.velocity=0,o.y&&i.scrollHeight>0?(this.scrollTop(this.scrollTop()+this.velocityY),Math.abs(this.velocityY)>0&&(this.velocityY=o.decelerate?n._decelerateVelocity(this.velocityY,o.slowdown):this.velocityY)):this.velocityY=0,n._setMoveClasses(o.deceleratingClass),e.isFunction(o.moved)&&o.moved.call(this,o),Math.abs(this.velocity)>0||Math.abs(this.velocityY)>0?this.moving||(this.moving=!0,window.requestAnimationFrame(function(){n.moving=!1,n._move()})):n.stop()},i.prototype._getScroller=function(){var t=this.$el;return(this.$el.is("body")||this.$el.is("html"))&&(t=e(window)),t},i.prototype.scrollLeft=function(e){var t=this._getScroller();return"number"!=typeof e?t.scrollLeft():(t.scrollLeft(e),void(this.settings.scrollLeft=e))},i.prototype.scrollTop=function(e){var t=this._getScroller();return"number"!=typeof e?t.scrollTop():(t.scrollTop(e),void(this.settings.scrollTop=e))},i.prototype._attachListeners=function(){var t=this.$el,i=this.settings;e.support.touch&&t.bind("touchstart",i.events.touchStart).bind("touchend",i.events.inputEnd).bind("touchmove",i.events.touchMove),t.mousedown(i.events.inputDown).mouseup(i.events.inputEnd).mousemove(i.events.inputMove),t.click(i.events.inputClick).scroll(i.events.scroll).bind("selectstart",i.events.selectStart).bind("dragstart",i.events.dragStart)},i.prototype._detachListeners=function(){var t=this.$el,i=this.settings;e.support.touch&&t.unbind("touchstart",i.events.touchStart).unbind("touchend",i.events.inputEnd).unbind("touchmove",i.events.touchMove),t.unbind("mousedown",i.events.inputDown).unbind("mouseup",i.events.inputEnd).unbind("mousemove",i.events.inputMove),t.unbind("click",i.events.inputClick).unbind("scroll",i.events.scroll).unbind("selectstart",i.events.selectStart).unbind("dragstart",i.events.dragStart)},e.Kinetic=i,e.fn.kinetic=function(t,n){return this.each(function(){var o=e(this),r=o.data(i.DATA_KEY),a=e.extend({},i.DEFAULTS,o.data(),"object"==typeof t&&t);r||o.data(i.DATA_KEY,r=new i(this,a)),"string"==typeof t&&r[t](n)})}}(n),function(e){e.Kinetic.prototype._attachListeners=function(){var t=this.$el,i=this.settings;e.support.touch&&t.bind("touchstart",i.events.touchStart).bind("touchend",i.events.inputEnd).bind("touchmove",i.events.touchMove),t.click(i.events.inputClick).scroll(i.events.scroll).bind("selectstart",i.events.selectStart).bind("dragstart",i.events.dragStart)},e.Kinetic.prototype._detachListeners=function(){var t=this.$el,i=this.settings;e.support.touch&&t.unbind("touchstart",i.events.touchStart).unbind("touchend",i.events.inputEnd).unbind("touchmove",i.events.touchMove),t.unbind("click",i.events.inputClick).unbind("scroll",i.events.scroll).unbind("selectstart",i.events.selectStart).unbind("dragstart",i.events.dragStart)}}(n)},function(e,t){e.exports=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var n=e.offsetWidth;return i==n&&(n=t.clientWidth),document.body.removeChild(t),i-n}},function(e,t){function i(e,t){e.on("dblclick",function(e){e.ctrlKey||t(e,s(e.currentTarget,e))});var i=a(l);e.on("contextmenu",function(e){e.preventDefault(),e.ctrlKey&&(i.isTriggered()?(i.reset(),t(e,s(e.currentTarget,e))):i.trigger())})}function n(e,t){var i=0;e.on("touchstart",function(e){e.preventDefault(),2===e.originalEvent.touches.length&&(i=r(e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY))}),e.on("touchmove",function(e){if(e.preventDefault(),2===e.originalEvent.touches.length){var n=e.originalEvent.touches,o=r(n[0].clientX,n[0].clientY,n[1].clientX,n[1].clientY),a=o-i;if(Math.abs(a)>0){var l={pageX:(n[0].clientX+n[1].clientX)/2,pageY:(n[0].clientY+n[1].clientY)/2};t(e,s(e.currentTarget,l),i,o)}}})}function o(e,t){var i=a(u),n=null;e.on("touchend",function(e){if(e.preventDefault(),i.isTriggered()){i.reset();var o={pageX:e.originalEvent.changedTouches[0].clientX,pageY:e.originalEvent.changedTouches[0].clientY},a=r(n.pageX,n.pageY,o.pageX,o.pageY);a<c&&t(e,s(e.currentTarget,o)),n=null}else n={pageX:e.originalEvent.changedTouches[0].clientX,pageY:e.originalEvent.changedTouches[0].clientY},i.trigger()})}function r(e,t,i,n){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))}function a(e){function t(){null!==n&&(clearTimeout(n),n=null)}var i=!1,n=null;return{trigger:function(){i=!0,t(),n=setTimeout(function(){i=!1,n=null},e)},isTriggered:function(){return i},reset:function(){i=!1,t()}}}function s(e,t){var i=e.getBoundingClientRect();return{left:t.pageX-i.left,top:t.pageY-i.top}}e.exports={onDoubleClick:i,onPinch:n,onDoubleTap:o};var l=500,c=50,u=250},function(e,t,i){function n(e){if(this._viewerCore=e,this._viewerState=e.getInternalState(),this._overlays=[],e.getPageTools().length)for(var t=e.getSettings().numPages,i=0;i<t;i++){var n=new a(i,e);this._overlays.push(n),e.addPageOverlay(n)}}function o(e,t,i){var n=i.top+i.height/2,o=i.left+i.width/2,a=r(e,function(e){var i=t.getPageDimensions(e),r=t.getPageOffset(e,{excludePadding:!1}),a=r.left+i.height/2,s=r.top+i.width/2,l=Math.max(Math.abs(o-a)-i.width/2,0),c=Math.max(Math.abs(n-s)-i.height/2,0);return-(l*l+c*c)});return null!=a?a:null}var r=i(19),a=i(21);e.exports=n,n.prototype.onDoubleClick=function(e,t){var i=this._viewerCore.getSettings(),n=e.ctrlKey?i.zoomLevel-1:i.zoomLevel+1,o=this._viewerCore.getPagePositionAtViewportOffset(t);this._viewerCore.zoom(n,o)},n.prototype.onPinch=function(e,t,i,n){var o=this._viewerCore.getInternalState(),r=this._viewerCore.getSettings(),a=Math.log(Math.pow(2,r.zoomLevel)*n/(i*Math.log(2)))/Math.log(2);if(a=Math.max(r.minZoomLevel,a),a=Math.min(r.maxZoomLevel,a),a!==r.zoomLevel){var s=this._viewerCore.getPagePositionAtViewportOffset(t),l=this._viewerCore.getCurrentLayout(),c=l.getPageToViewportCenterOffset(s.anchorPage,o.viewport),u=1/Math.pow(2,r.zoomLevel-a);this._viewerCore.reload({zoomLevel:a,goDirectlyTo:s.anchorPage,horizontalOffset:c.x-s.offset.left+s.offset.left*u,verticalOffset:c.y-s.offset.top+s.offset.top*u})}},n.prototype.onViewWillLoad=function(){this._viewerCore.publish("DocumentWillLoad",this._viewerCore.getSettings())},n.prototype.onViewDidLoad=function(){this._handleZoomLevelChange();var e=this._viewerCore.getSettings().currentPageIndex,t=this._viewerCore.getPageName(e);this._viewerCore.publish("DocumentDidLoad",e,t)},n.prototype.onViewDidUpdate=function(e,t){var i=null!==t?t:o(e,this._viewerCore.getCurrentLayout(),this._viewerCore.getViewport());null!==i&&this._viewerCore.setCurrentPage(i),null!==t&&this._viewerCore.publish("ViewerDidJump",t),this._handleZoomLevelChange()},n.prototype._handleZoomLevelChange=function(){var e=this._viewerState,t=e.options.zoomLevel;e.oldZoomLevel!==t&&e.oldZoomLevel>=0&&(e.oldZoomLevel<t?this._viewerCore.publish("ViewerDidZoomIn",t):this._viewerCore.publish("ViewerDidZoomOut",t),this._viewerCore.publish("ViewerDidZoom",t)),e.oldZoomLevel=t},n.prototype.destroy=function(){this._overlays.forEach(function(e){this._viewerCore.removePageOverlay(e)},this)}},function(e,t,i){(function(e,i){function n(e,t){for(var i=-1,n=e?e.length:0;++i<n;)if(t(e[i],i,e))return!0;return!1}function o(e){return function(t){return null==t?void 0:t[e]}}function r(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}function a(e){return function(t){return e(t)}}function s(e,t){return null==e?void 0:e[t]}function l(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(i){}return t}function c(e){var t=-1,i=Array(e.size);return e.forEach(function(e,n){i[++t]=[n,e]}),i}function u(e,t){return function(i){return e(t(i))}}function h(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}function d(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function g(){this.__data__=ei?ei(null):{}}function f(e){return this.has(e)&&delete this.__data__[e]}function p(e){var t=this.__data__;if(ei){var i=t[e];return i===Ve?void 0:i}return Ht.call(t,e)?t[e]:void 0}function v(e){var t=this.__data__;return ei?void 0!==t[e]:Ht.call(t,e)}function m(e,t){var i=this.__data__;return i[e]=ei&&void 0===t?Ve:t,this}function w(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function y(){this.__data__=[]}function b(e){var t=this.__data__,i=Z(t,e);if(i<0)return!1;var n=t.length-1;return i==n?t.pop():Ut.call(t,i,1),!0}function _(e){var t=this.__data__,i=Z(t,e);return i<0?void 0:t[i][1]}function P(e){return Z(this.__data__,e)>-1}function x(e,t){var i=this.__data__,n=Z(i,e);return n<0?i.push([e,t]):i[n][1]=t,this}function I(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function L(){this.__data__={hash:new d,map:new($t||w),string:new d}}function C(e){return se(this,e)["delete"](e)}function O(e){return se(this,e).get(e)}function D(e){return se(this,e).has(e)}function T(e,t){return se(this,e).set(e,t),this}function k(e){var t=-1,i=e?e.length:0;for(this.__data__=new I;++t<i;)this.add(e[t])}function S(e){return this.__data__.set(e,Ve),this}function E(e){return this.__data__.has(e)}function M(e){this.__data__=new w(e)}function z(){this.__data__=new w}function j(e){return this.__data__["delete"](e)}function A(e){return this.__data__.get(e)}function R(e){return this.__data__.has(e)}function F(e,t){var i=this.__data__;if(i instanceof w){var n=i.__data__;if(!$t||n.length<Re-1)return n.push([e,t]),this;i=this.__data__=new I(n)}return i.set(e,t),this}function V(e,t){var i=hi(e)||Pe(e)?r(e.length,String):[],n=i.length,o=!!n;for(var a in e)!t&&!Ht.call(e,a)||o&&("length"==a||he(a,n))||i.push(a);return i}function Z(e,t){for(var i=e.length;i--;)if(_e(e[i][0],t))return i;return-1}function H(e,t,i){for(var n=-1,o=e.length;++n<o;){var r=e[n],a=t(r);if(null!=a&&(void 0===s?a===a&&!Te(a):i(a,s)))var s=a,l=r}return l}function N(e,t){t=de(t,e)?[t]:ne(t);for(var i=0,n=t.length;null!=e&&i<n;)e=e[we(t[i++])];return i&&i==n?e:void 0}function G(e){return Nt.call(e)}function B(e,t){return e>t}function W(e,t){return null!=e&&t in Object(e)}function Y(e,t,i,n,o){return e===t||(null==e||null==t||!Oe(e)&&!De(t)?e!==e&&t!==t:U(e,t,Y,i,n,o))}function U(e,t,i,n,o,r){var a=hi(e),s=hi(t),c=We,u=We;a||(c=ci(e),c=c==Be?Qe:c),s||(u=ci(t),u=u==Be?Qe:u);var h=c==Qe&&!l(e),d=u==Qe&&!l(t),g=c==u;if(g&&!h)return r||(r=new M),a||di(e)?oe(e,t,i,n,o,r):re(e,t,c,i,n,o,r);if(!(o&He)){var f=h&&Ht.call(e,"__wrapped__"),p=d&&Ht.call(t,"__wrapped__");if(f||p){var v=f?e.value():e,m=p?t.value():t;return r||(r=new M),i(v,m,n,o,r)}}return!!g&&(r||(r=new M),ae(e,t,i,n,o,r))}function q(e,t,i,n){var o=i.length,r=o,a=!n;if(null==e)return!r;for(e=Object(e);o--;){var s=i[o];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++o<r;){s=i[o];var l=s[0],c=e[l],u=s[1];if(a&&s[2]){if(void 0===c&&!(l in e))return!1}else{var h=new M;if(n)var d=n(c,u,l,e,t,h);if(!(void 0===d?Y(u,c,n,Ze|He,h):d))return!1}}return!0}function X(e){if(!Oe(e)||fe(e))return!1;var t=Le(e)||l(e)?Gt:xt;return t.test(ye(e))}function $(e){return De(e)&&Ce(e.length)&&!!Lt[Nt.call(e)]}function K(e){return"function"==typeof e?e:null==e?ze:"object"==typeof e?hi(e)?ee(e[0],e[1]):Q(e):je(e)}function J(e){if(!pe(e))return qt(e);var t=[];for(var i in Object(e))Ht.call(e,i)&&"constructor"!=i&&t.push(i);return t}function Q(e){var t=le(e);return 1==t.length&&t[0][2]?me(t[0][0],t[0][1]):function(i){return i===e||q(i,e,t)}}function ee(e,t){return de(e)&&ve(t)?me(we(e),t):function(i){var n=Se(i,e);return void 0===n&&n===t?Ee(i,e):Y(t,n,void 0,Ze|He)}}function te(e){return function(t){return N(t,e)}}function ie(e){if("string"==typeof e)return e;if(Te(e))return li?li.call(e):"";var t=e+"";return"0"==t&&1/e==-Ne?"-0":t}function ne(e){return hi(e)?e:ui(e)}function oe(e,t,i,o,r,a){var s=r&He,l=e.length,c=t.length;if(l!=c&&!(s&&c>l))return!1;var u=a.get(e);if(u&&a.get(t))return u==t;var h=-1,d=!0,g=r&Ze?new k:void 0;for(a.set(e,t),a.set(t,e);++h<l;){var f=e[h],p=t[h];if(o)var v=s?o(p,f,h,t,e,a):o(f,p,h,e,t,a);if(void 0!==v){if(v)continue;d=!1;break}if(g){if(!n(t,function(e,t){if(!g.has(t)&&(f===e||i(f,e,o,r,a)))return g.add(t)})){d=!1;break}}else if(f!==p&&!i(f,p,o,r,a)){d=!1;break}}return a["delete"](e),a["delete"](t),d}function re(e,t,i,n,o,r,a){switch(i){case st:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case at:return!(e.byteLength!=t.byteLength||!n(new Wt(e),new Wt(t)));case Ye:case Ue:case Je:return _e(+e,+t);case qe:return e.name==t.name&&e.message==t.message;case tt:case nt:return e==t+"";case Ke:var s=c;case it:var l=r&He;if(s||(s=h),e.size!=t.size&&!l)return!1;var u=a.get(e);if(u)return u==t;r|=Ze,a.set(e,t);var d=oe(s(e),s(t),n,o,r,a);return a["delete"](e),d;case ot:if(si)return si.call(e)==si.call(t)}return!1}function ae(e,t,i,n,o,r){var a=o&He,s=Me(e),l=s.length,c=Me(t),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=s[h];if(!(a?d in t:Ht.call(t,d)))return!1}var g=r.get(e);if(g&&r.get(t))return g==t;var f=!0;r.set(e,t),r.set(t,e);for(var p=a;++h<l;){d=s[h];var v=e[d],m=t[d];if(n)var w=a?n(m,v,d,t,e,r):n(v,m,d,e,t,r);if(!(void 0===w?v===m||i(v,m,n,o,r):w)){f=!1;break}p||(p="constructor"==d)}if(f&&!p){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(f=!1)}return r["delete"](e),r["delete"](t),f}function se(e,t){var i=e.__data__;return ge(t)?i["string"==typeof t?"string":"hash"]:i.map}function le(e){for(var t=Me(e),i=t.length;i--;){var n=t[i],o=e[n];t[i]=[n,o,ve(o)]}return t}function ce(e,t){var i=s(e,t);return X(i)?i:void 0}function ue(e,t,i){t=de(t,e)?[t]:ne(t);for(var n,o=-1,r=t.length;++o<r;){var a=we(t[o]);if(!(n=null!=e&&i(e,a)))break;e=e[a]}if(n)return n;var r=e?e.length:0;return!!r&&Ce(r)&&he(a,r)&&(hi(e)||Pe(e))}function he(e,t){return t=null==t?Ge:t,!!t&&("number"==typeof e||It.test(e))&&e>-1&&e%1==0&&e<t}function de(e,t){if(hi(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!Te(e))||(wt.test(e)||!mt.test(e)||null!=t&&e in Object(t))}function ge(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function fe(e){return!!Vt&&Vt in e}function pe(e){var t=e&&e.constructor,i="function"==typeof t&&t.prototype||Rt;return e===i}function ve(e){return e===e&&!Oe(e)}function me(e,t){return function(i){return null!=i&&(i[e]===t&&(void 0!==t||e in Object(i)))}}function we(e){if("string"==typeof e||Te(e))return e;var t=e+"";return"0"==t&&1/e==-Ne?"-0":t}function ye(e){if(null!=e){try{return Zt.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function be(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(Fe);var i=function(){var n=arguments,o=t?t.apply(this,n):n[0],r=i.cache;if(r.has(o))return r.get(o);var a=e.apply(this,n);return i.cache=r.set(o,a),a};return i.cache=new(be.Cache||I),i}function _e(e,t){return e===t||e!==e&&t!==t}function Pe(e){return Ie(e)&&Ht.call(e,"callee")&&(!Yt.call(e,"callee")||Nt.call(e)==Be)}function xe(e){return null!=e&&Ce(e.length)&&!Le(e)}function Ie(e){return De(e)&&xe(e)}function Le(e){var t=Oe(e)?Nt.call(e):"";return t==Xe||t==$e}function Ce(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Ge}function Oe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function De(e){return!!e&&"object"==typeof e}function Te(e){return"symbol"==typeof e||De(e)&&Nt.call(e)==ot}function ke(e){return null==e?"":ie(e)}function Se(e,t,i){var n=null==e?void 0:N(e,t);return void 0===n?i:n}function Ee(e,t){return null!=e&&ue(e,t,W)}function Me(e){return xe(e)?V(e):J(e)}function ze(e){return e}function je(e){return de(e)?o(we(e)):te(e)}function Ae(e,t){return e&&e.length?H(e,K(t,2),B):void 0}var Re=200,Fe="Expected a function",Ve="__lodash_hash_undefined__",Ze=1,He=2,Ne=1/0,Ge=9007199254740991,Be="[object Arguments]",We="[object Array]",Ye="[object Boolean]",Ue="[object Date]",qe="[object Error]",Xe="[object Function]",$e="[object GeneratorFunction]",Ke="[object Map]",Je="[object Number]",Qe="[object Object]",et="[object Promise]",tt="[object RegExp]",it="[object Set]",nt="[object String]",ot="[object Symbol]",rt="[object WeakMap]",at="[object ArrayBuffer]",st="[object DataView]",lt="[object Float32Array]",ct="[object Float64Array]",ut="[object Int8Array]",ht="[object Int16Array]",dt="[object Int32Array]",gt="[object Uint8Array]",ft="[object Uint8ClampedArray]",pt="[object Uint16Array]",vt="[object Uint32Array]",mt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wt=/^\w*$/,yt=/^\./,bt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_t=/[\\^$.*+?()[\]{}|]/g,Pt=/\\(\\)?/g,xt=/^\[object .+?Constructor\]$/,It=/^(?:0|[1-9]\d*)$/,Lt={};Lt[lt]=Lt[ct]=Lt[ut]=Lt[ht]=Lt[dt]=Lt[gt]=Lt[ft]=Lt[pt]=Lt[vt]=!0,Lt[Be]=Lt[We]=Lt[at]=Lt[Ye]=Lt[st]=Lt[Ue]=Lt[qe]=Lt[Xe]=Lt[Ke]=Lt[Je]=Lt[Qe]=Lt[tt]=Lt[it]=Lt[nt]=Lt[rt]=!1;var Ct="object"==typeof e&&e&&e.Object===Object&&e,Ot="object"==typeof self&&self&&self.Object===Object&&self,Dt=Ct||Ot||Function("return this")(),Tt="object"==typeof t&&t&&!t.nodeType&&t,kt=Tt&&"object"==typeof i&&i&&!i.nodeType&&i,St=kt&&kt.exports===Tt,Et=St&&Ct.process,Mt=function(){try{return Et&&Et.binding("util")}catch(e){}}(),zt=Mt&&Mt.isTypedArray,jt=Array.prototype,At=Function.prototype,Rt=Object.prototype,Ft=Dt["__core-js_shared__"],Vt=function(){var e=/[^.]+$/.exec(Ft&&Ft.keys&&Ft.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Zt=At.toString,Ht=Rt.hasOwnProperty,Nt=Rt.toString,Gt=RegExp("^"+Zt.call(Ht).replace(_t,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bt=Dt.Symbol,Wt=Dt.Uint8Array,Yt=Rt.propertyIsEnumerable,Ut=jt.splice,qt=u(Object.keys,Object),Xt=ce(Dt,"DataView"),$t=ce(Dt,"Map"),Kt=ce(Dt,"Promise"),Jt=ce(Dt,"Set"),Qt=ce(Dt,"WeakMap"),ei=ce(Object,"create"),ti=ye(Xt),ii=ye($t),ni=ye(Kt),oi=ye(Jt),ri=ye(Qt),ai=Bt?Bt.prototype:void 0,si=ai?ai.valueOf:void 0,li=ai?ai.toString:void 0;d.prototype.clear=g,d.prototype["delete"]=f,d.prototype.get=p,d.prototype.has=v,d.prototype.set=m,w.prototype.clear=y,w.prototype["delete"]=b,w.prototype.get=_,w.prototype.has=P,w.prototype.set=x,I.prototype.clear=L,I.prototype["delete"]=C,I.prototype.get=O,I.prototype.has=D,I.prototype.set=T,k.prototype.add=k.prototype.push=S,k.prototype.has=E,M.prototype.clear=z,M.prototype["delete"]=j,M.prototype.get=A,M.prototype.has=R,M.prototype.set=F;var ci=G;(Xt&&ci(new Xt(new ArrayBuffer(1)))!=st||$t&&ci(new $t)!=Ke||Kt&&ci(Kt.resolve())!=et||Jt&&ci(new Jt)!=it||Qt&&ci(new Qt)!=rt)&&(ci=function(e){var t=Nt.call(e),i=t==Qe?e.constructor:void 0,n=i?ye(i):void 0;if(n)switch(n){case ti:return st;case ii:return Ke;case ni:return et;case oi:return it;case ri:return rt}return t});var ui=be(function(e){e=ke(e);var t=[];return yt.test(e)&&t.push(""),e.replace(bt,function(e,i,n,o){t.push(n?o.replace(Pt,"$1"):i||e)}),t});be.Cache=I;var hi=Array.isArray,di=zt?a(zt):$;i.exports=Ae}).call(t,function(){return this}(),i(20)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,i){function n(e,t){this.page=e,this._viewerCore=t,this._innerElement=t.getSettings().innerElement,this._pageToolsElem=null}var o=i(8);e.exports=n,n.prototype.mount=function(){if(null===this._pageToolsElem){var e=this._initializePageToolButtons();this._pageToolsElem=o("div",{"class":"diva-page-tools-wrapper"},o("div",{"class":"diva-page-tools"},e))}this.refresh(),this._innerElement.appendChild(this._pageToolsElem)},n.prototype._initializePageToolButtons=function(){var e=this._viewerCore.getSettings(),t=this._viewerCore.getPublicInstance(),i=this.page;return this._viewerCore.getPageTools().map(function(n){var r=n.titleText||n.pluginName[0].toUpperCase()+n.pluginName.substring(1)+" plugin",a=o("div",{"class":"diva-"+n.pluginName+"-icon",title:r});return a.addEventListener("click",function(o){n.handleClick.call(this,o,e,t,i)},!1),a.addEventListener("touchend",function(o){o.preventDefault(),n.handleClick.call(this,o,e,t,i)},!1),a},this)},n.prototype.unmount=function(){this._innerElement.removeChild(this._pageToolsElem)},n.prototype.refresh=function(){var e=this._viewerCore.getPageRegion(this.page,{excludePadding:!0,incorporateViewport:!0});this._pageToolsElem.style.top=e.top+"px",this._pageToolsElem.style.left=e.left+"px"}},function(e,t,i){function n(e){this._viewerCore=e}function o(e,t){var i=t.top+t.height/2;return r(e,function(e){var t=e.region.top+e.dimensions.height/2;return-Math.abs(i-t)})}var r=i(19);e.exports=n,n.prototype.onDoubleClick=function(e,t){var i=this._viewerCore.getPagePositionAtViewportOffset(t),n=this._viewerCore.getCurrentLayout(),o=this._viewerCore.getViewport(),r=n.getPageToViewportCenterOffset(i.anchorPage,o);this._viewerCore.reload({inGrid:!1,goDirectlyTo:i.anchorPage,horizontalOffset:r.x+i.offset.left,verticalOffset:r.y+i.offset.top})},n.prototype.onPinch=function(){this._viewerCore.reload({inGrid:!1})},n.prototype.onViewWillLoad=function(){},n.prototype.onViewDidLoad=function(){},n.prototype.onViewDidUpdate=function(e,t){if(null!==t)return void this._viewerCore.setCurrentPage(t);var i=this._viewerCore.getCurrentLayout(),n=[];e.forEach(function(e){var t=i.getPageInfo(e).group;0!==n.length&&t===n[n.length-1]||n.push(t)});var r,a=this._viewerCore.getViewport();r=1===n.length||n[0].region.top>=a.top?n[0]:n[1].region.bottom<=a.bottom?n[1]:o(n,a);var s=this._viewerCore.getSettings().currentPageIndex,l=r.pages.some(function(e){return e.index===s});l||this._viewerCore.setCurrentPage(r.pages[0].index)},n.prototype.destroy=function(){}},function(e,t){function i(){this._pages={},this._renderedPages=[],this._renderedPageMap={}}e.exports=i,i.prototype.addOverlay=function(e){var t=this._pages[e.page]||(this._pages[e.page]=[]);t.push(e),this._renderedPageMap[e.page]&&e.mount()},i.prototype.removeOverlay=function(e){var t=e.page,i=this._pages[t];if(i){var n=i.indexOf(e);n!==-1&&(this._renderedPageMap[t]&&i[n].unmount(),i.splice(n,1),0===i.length&&delete this._pages[t])}},i.prototype.updateOverlays=function(e){var t=this._renderedPages,i={};e.forEach(function(e){i[e]=!0,this._renderedPageMap[e]||(this._renderedPageMap[e]=!0,this._invokeOnOverlays(e,function(e){e.mount()}))},this),t.forEach(function(e){i[e]?this._invokeOnOverlays(e,function(e){e.refresh()}):(delete this._renderedPageMap[e],this._invokeOnOverlays(e,function(e){e.unmount()}))},this),this._renderedPages=e},i.prototype._invokeOnOverlays=function(e,t){var i=this._pages[e];i&&i.forEach(t,this)}},function(e,t,i){"use strict";function n(e,t){this._viewport=e.viewport,this._outerElement=e.outerElement,this._documentElement=e.innerElement,this._hooks=t||{},this._canvas=l("canvas",{"class":"diva-viewer-canvas"}),this._ctx=this._canvas.getContext("2d"),this.layout=null,this._sourceResolver=null,this._renderedPages=null,this._config=null,this._zoomLevel=null,this._compositeImages=null,this._renderedTiles=null,this._animation=null,this._cache=new h,this._pendingRequests={}}function o(e,t){var i;return i=null===t?1:Math.pow(2,t-e.zoomLevel),{sourceZoomLevel:e.zoomLevel,scaleRatio:i,row:e.row,col:e.col,dimensions:{width:e.dimensions.width*i,height:e.dimensions.height*i},offset:{left:e.offset.left*i,top:e.offset.top*i},url:e.url}}function r(e,t){if(e===t)return{added:[],removed:[]};var i=e.filter(function(e){return t.indexOf(e)===-1}),n=t.filter(function(t){return e.indexOf(t)===-1});return{added:n,removed:i}}var a=i(25)("diva:Renderer"),s=i(25)("diva:Renderer:paints"),l=i(8),c=i(28),u=i(29),h=i(30),d=i(31),g=i(32),f=250;e.exports=n,n.getCompatibilityErrors=function(){return"undefined"!=typeof HTMLCanvasElement?null:["Your browser lacks support for the ",l("pre","canvas")," element. Please upgrade your browser."]},n.prototype.load=function(e,t,i){if(this._clearAnimation(),this._hooks.onViewWillLoad&&this._hooks.onViewWillLoad(),this._sourceResolver=i,this._config=e,this._compositeImages={},this._setLayoutToZoomLevel(t.zoomLevel),!this.layout.getPageInfo(t.anchorPage))throw new Error("invalid page: "+t.anchorPage);this._canvas.width!==this._viewport.width||this._canvas.height!==this._viewport.height?(a("Canvas dimension change: (%s, %s) -> (%s, %s)",this._canvas.width,this._canvas.height,this._viewport.width,this._viewport.height),this._canvas.width=this._viewport.width,this._canvas.height=this._viewport.height):a("Reload, no size change"),this["goto"](t.anchorPage,t.verticalOffset,t.horizontalOffset),this._canvas.parentNode!==this._outerElement&&this._outerElement.insertBefore(this._canvas,this._outerElement.firstChild),this._hooks.onViewDidLoad&&this._hooks.onViewDidLoad()},n.prototype._setViewportPosition=function(e){if(e.zoomLevel!==this._zoomLevel){if(null===this._zoomLevel)throw new TypeError("The current view is not zoomable");if(null===e.zoomLevel)throw new TypeError("The current view requires a zoom level");this._setLayoutToZoomLevel(e.zoomLevel)}this._goto(e.anchorPage,e.verticalOffset,e.horizontalOffset)},n.prototype._setLayoutToZoomLevel=function(e){this.layout=new u(this._config,e),this._zoomLevel=e,l.setAttributes(this._documentElement,{style:{height:this.layout.dimensions.height+"px",width:this.layout.dimensions.width+"px"}}),this._viewport.setInnerDimensions(this.layout.dimensions)},n.prototype.adjust=function(e){this._clearAnimation(),this._render(e),this._hooks.onViewDidUpdate&&this._hooks.onViewDidUpdate(this._renderedPages.slice(),null)},n.prototype._render=function(e){var t=[];this.layout.pageGroups.forEach(function(e){if(this._viewport.intersectsRegion(e.region)){var i=e.pages.filter(function(e){
return this.isPageVisible(e.index)},this).map(function(e){return e.index});t.push.apply(t,i)}},this),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._paintOutline(t),t.forEach(function(e){if(!this._compositeImages[e]){var t=this.layout.getPageInfo(e),i=this._sourceResolver.getAllZoomLevelsForPage(t),n=new c(i);n.updateFromCache(this._cache),this._compositeImages[e]=n}},this),this._initiateTileRequests(t);var i=r(this._renderedPages||[],t);i.removed.forEach(function(e){delete this._compositeImages[e]},this),this._renderedPages=t,this._paint(),this._hooks.onPageWillLoad&&i.added.forEach(function(e){this._hooks.onPageWillLoad(e)},this)},n.prototype._paint=function(){a("Repainting");var e=[];this._renderedPages.forEach(function(t){this._compositeImages[t].getTiles(this._zoomLevel).forEach(function(i){var n=o(i,this._zoomLevel);this._isTileVisible(t,n)&&(e.push(i.url),this._drawTile(t,n,this._cache.get(i.url)))},this)},this);var t=this._cache,i=r(this._renderedTiles||[],e);i.added.forEach(function(e){t.acquire(e)}),i.removed.forEach(function(e){t.release(e)}),i.removed&&this._renderedPages.forEach(function(e){this._compositeImages[e].updateFromCache(this._cache)},this),this._renderedTiles=e},n.prototype._paintOutline=function(e){e.forEach(function(e){var t=this.layout.getPageInfo(e),i=this._getImageOffset(e),n=Math.max(0,(this._viewport.width-this.layout.dimensions.width)/2),o=Math.max(0,(this._viewport.height-this.layout.dimensions.height)/2),r=i.left-this._viewport.left+n,a=i.top-this._viewport.top+o,s=r<0?-r:0,l=a<0?-a:0,c=Math.max(0,r),u=Math.max(0,a),h=t.dimensions.width-s,d=t.dimensions.height-l;this._ctx.strokeStyle="#AAA",this._ctx.strokeRect(c+.5,u+.5,h,d)},this)},n.prototype._initiateTileRequests=function(e){for(var t={},i=function(e,i){var n=this._compositeImages[i];t[e.url]=new d({url:e.url,timeoutTime:f,load:function(t){delete this._pendingRequests[e.url],this._cache.put(e.url,t),n===this._compositeImages[i]&&(n.updateWithLoadedUrls([e.url]),this._isTileForSourceVisible(i,e)?this._paint():s("Page %s, tile %s no longer visible on image load",i,e.url))}.bind(this),error:function(){delete this._pendingRequests[e.url]}.bind(this)})}.bind(this),n=0;n<e.length;n++)for(var o=e[n],r=this._sourceResolver.getBestZoomLevelForPage(this.layout.getPageInfo(o)).tiles,a=0;a<r.length;a++){var l=r[a];!this._cache.has(l.url)&&this._isTileForSourceVisible(o,l)&&(this._pendingRequests[l.url]?(t[l.url]=this._pendingRequests[l.url],delete this._pendingRequests[l.url]):i(l,o))}for(var c in this._pendingRequests)this._pendingRequests[c].abort();this._pendingRequests=t},n.prototype._drawTile=function(e,t,i){var n=this._getTileToDocumentOffset(e,t),o=Math.max(0,(this._viewport.width-this.layout.dimensions.width)/2),r=Math.max(0,(this._viewport.height-this.layout.dimensions.height)/2),a=n.left-this._viewport.left+o,l=n.top-this._viewport.top+r,c=a<0?-a:0,u=l<0?-l:0,h=c/t.scaleRatio,d=u/t.scaleRatio,g=Math.max(0,a),f=Math.max(0,l),p=Math.min(t.dimensions.width,i.width*t.scaleRatio)-c,v=Math.min(t.dimensions.height,i.height*t.scaleRatio)-u,m=p/t.scaleRatio,w=v/t.scaleRatio;s.enabled&&s("Drawing page %s, tile %sx (%s, %s) from %s, %s to viewport at %s, %s, scale %s%%",e,t.sourceZoomLevel,t.row,t.col,h,d,g,f,Math.round(100*t.scaleRatio)),this._ctx.drawImage(i,h,d,m,w,g,f,p,v)},n.prototype._isTileForSourceVisible=function(e,t){return this._isTileVisible(e,o(t,this._zoomLevel))},n.prototype._isTileVisible=function(e,t){var i=this._getTileToDocumentOffset(e,t);return this._viewport.intersectsRegion({top:i.top,bottom:i.top+t.dimensions.height,left:i.left,right:i.left+t.dimensions.width})},n.prototype._getTileToDocumentOffset=function(e,t){var i=this._getImageOffset(e);return{top:i.top+t.offset.top,left:i.left+t.offset.left}},n.prototype._getImageOffset=function(e){return this.layout.getPageOffset(e,{excludePadding:!0})},n.prototype["goto"]=function(e,t,i){this._clearAnimation(),this._goto(e,t,i),this._hooks.onViewDidUpdate&&this._hooks.onViewDidUpdate(this._renderedPages.slice(),e)},n.prototype._goto=function(e,t,i){var n=this.layout.getPageOffset(e),o=n.top+t,r=o-parseInt(this._viewport.height/2,10),a=n.left+i,s=a-parseInt(this._viewport.width/2,10);this._viewport.top=r,this._viewport.left=s,this._render(0)},n.prototype.transitionViewportPosition=function(e){this._clearAnimation();var t=e.getPosition,i=this,n=this._hooks.onViewDidTransition;this._animation=g.animate({duration:e.duration,parameters:e.parameters,onUpdate:function(e){i._setViewportPosition(t(e)),n&&n()},onEnd:function(t){e.onEnd&&e.onEnd(t),i._hooks.onViewDidUpdate&&!t.interrupted&&i._hooks.onViewDidUpdate(i._renderedPages.slice(),null)}})},n.prototype._clearAnimation=function(){this._animation&&(this._animation.cancel(),this._animation=null)},n.prototype.preload=function(){},n.prototype.isPageVisible=function(e){if(!this.layout)return!1;var t=this.layout.getPageInfo(e);return!!t&&this._viewport.intersectsRegion(this.layout.getPageRegion(e))},n.prototype.getRenderedPages=function(){return this._renderedPages.slice()},n.prototype.destroy=function(){this._clearAnimation(),Object.keys(this._pendingRequests).forEach(function(e){var t=this._pendingRequests[e];delete this._pendingRequests[e],t.abort()},this),this._canvas.parentNode.removeChild(this._canvas)}},function(e,t,i){function n(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var e=arguments,i=this.useColors;if(e[0]=(i?"%c":"")+this.namespace+(i?" %c":" ")+e[0]+(i?"%c ":" ")+"+"+t.humanize(this.diff),!i)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,r=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(r=o))}),e.splice(r,0,n),e}function r(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(i){}}function s(){var e;try{e=t.storage.debug}catch(i){}return e}function l(){try{return window.localStorage}catch(e){}}t=e.exports=i(26),t.log=r,t.formatArgs=o,t.save=a,t.load=s,t.useColors=n,t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:l(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){return JSON.stringify(e)},t.enable(s())},function(e,t,i){function n(){return t.colors[u++%t.colors.length]}function o(e){function i(){}function o(){var e=o,i=+new Date,r=i-(c||i);e.diff=r,e.prev=c,e.curr=i,c=i,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=n());var a=Array.prototype.slice.call(arguments);a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var s=0;a[0]=a[0].replace(/%([a-z%])/g,function(i,n){if("%%"===i)return i;s++;var o=t.formatters[n];if("function"==typeof o){var r=a[s];i=o.call(e,r),a.splice(s,1),s--}return i}),"function"==typeof t.formatArgs&&(a=t.formatArgs.apply(e,a));var l=o.log||t.log||console.log.bind(console);l.apply(e,a)}i.enabled=!1,o.enabled=!0;var r=t.enabled(e)?o:i;return r.namespace=e,r}function r(e){t.save(e);for(var i=(e||"").split(/[\s,]+/),n=i.length,o=0;o<n;o++)i[o]&&(e=i[o].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))}function a(){t.enable("")}function s(e){var i,n;for(i=0,n=t.skips.length;i<n;i++)if(t.skips[i].test(e))return!1;for(i=0,n=t.names.length;i<n;i++)if(t.names[i].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=o,t.coerce=l,t.disable=a,t.enable=r,t.enabled=s,t.humanize=i(27),t.names=[],t.skips=[],t.formatters={};var c,u=0},function(e,t){function i(e){if(e=""+e,!(e.length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return i*u;case"days":case"day":case"d":return i*c;case"hours":case"hour":case"hrs":case"hr":case"h":return i*l;case"minutes":case"minute":case"mins":case"min":case"m":return i*s;case"seconds":case"second":case"secs":case"sec":case"s":return i*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i}}}}function n(e){return e>=c?Math.round(e/c)+"d":e>=l?Math.round(e/l)+"h":e>=s?Math.round(e/s)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function o(e){return r(e,c,"day")||r(e,l,"hour")||r(e,s,"minute")||r(e,a,"second")||e+" ms"}function r(e,t,i){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+i:Math.ceil(e/t)+" "+i+"s"}var a=1e3,s=60*a,l=60*s,c=24*l,u=365.25*c;e.exports=function(e,t){return t=t||{},"string"==typeof e?i(e):t["long"]?o(e):n(e)}},function(e,t){function i(e){this._levels=e;var t=this._urlsToTiles={};e.forEach(function(e){e.tiles.forEach(function(i){t[i.url]={zoomLevel:e.zoomLevel,row:i.row,col:i.col}})}),this.clear()}function n(e,t){this._rows=e,this._cols=t,this._map=o(e).map(function(){return o(t,!1)})}function o(e,t){for(var i=new Array(e),n=0;n<e;n++)i[n]=t;return i}function r(e,t){for(var i=e.length,n=0;n<i;n++)if(t(e[n],n))return n;return-1}e.exports=i,i.prototype.clear=function(){var e=this._loadedByLevel={};this._levels.forEach(function(t){e[t.zoomLevel]=new n(t.rows,t.cols)})},i.prototype.getTiles=function(e){var t,i=[],o=this._levels[0].zoomLevel,a=new n(this._levels[0].rows,this._levels[0].cols);if(null===e)t=0;else{var s=Math.ceil(e);t=r(this._levels,function(e){return e.zoomLevel<=s})}var l=this._levels.slice(0,t+1).reverse().concat(this._levels.slice(t+1));l.forEach(function(e){var t=this._loadedByLevel[e.zoomLevel],n=e.tiles.filter(function(e){return t.isLoaded(e.row,e.col)}),r=Math.pow(2,o-e.zoomLevel);n=n.filter(function(e){for(var t=!1,i=e.row*r,n=e.col*r,o=0;o<r;o++)for(var s=0;s<r;s++)a.isLoaded(i+o,n+s)||(t=!0,a.set(i+o,n+s,!0));return t}),i.push(n)},this),i.reverse();var c=[];return i.forEach(function(e){c.push.apply(c,e)}),c},i.prototype.updateFromCache=function(e){this.clear(),this._levels.forEach(function(t){var i=this._loadedByLevel[t.zoomLevel];t.tiles.forEach(function(t){e.has(t.url)&&i.set(t.row,t.col,!0)})},this)},i.prototype.updateWithLoadedUrls=function(e){e.forEach(function(e){var t=this._urlsToTiles[e];this._loadedByLevel[t.zoomLevel].set(t.row,t.col,!0)},this)},n.prototype.isLoaded=function(e,t){return e>=this._rows||t>=this._cols||this._map[e][t]},n.prototype.set=function(e,t,i){this._map[e][t]=i}},function(e,t){function i(e,t){var i=r(e,t);this.dimensions=i.dimensions,this.pageGroups=i.pageGroups,this._pageLookup=o(i.pageGroups)}function n(e){var t=e.groupOffset.top+e.group.region.top,i=t+e.dimensions.height,n=e.groupOffset.left+e.group.region.left,o=n+e.dimensions.width;return{top:t,bottom:i,left:n,right:o}}function o(e){var t={};return e.forEach(function(e){e.pages.forEach(function(i){t[i.index]={index:i.index,group:e,dimensions:i.dimensions,groupOffset:i.groupOffset}})}),t}function r(e,t){var i=null===t?e.pageLayouts:a(e,t),n=l(e,i),o=e.verticallyOriented?e.padding.document.top:e.padding.document.left,r=[],s={top:e.padding.page.top,left:e.padding.page.left};i.forEach(function(t,i){var a,l;e.verticallyOriented?(a=o,l=(n-t.dimensions.width)/2):(a=(n-t.dimensions.height)/2,l=o);var c={top:a,bottom:a+s.top+t.dimensions.height,left:l,right:l+s.left+t.dimensions.width};r.push({index:i,dimensions:t.dimensions,pages:t.pages,region:c,padding:s}),o=e.verticallyOriented?c.bottom:c.right});var c,u;return e.verticallyOriented?(c=o+s.top,u=n):(c=n,u=o+s.left),{dimensions:{height:c,width:u},pageGroups:r}}function a(e,t){var i=Math.pow(2,t-e.maxZoomLevel);return e.pageLayouts.map(function(e){return{dimensions:s(e.dimensions,i),pages:e.pages.map(function(e){return{index:e.index,groupOffset:{top:Math.floor(e.groupOffset.top*i),left:Math.floor(e.groupOffset.left*i)},dimensions:s(e.dimensions,i)}})}})}function s(e,t){return{height:Math.floor(e.height*t),width:Math.floor(e.width*t)}}function l(e,t){var i,n,o=e.padding.document;return e.verticallyOriented?(i="width",n=o.left+o.right):(i="height",n=o.top+o.bottom),n+t.reduce(function(e,t){return Math.max(t.dimensions[i],e)},0)}e.exports=i,i.prototype.getPageInfo=function(e){return this._pageLookup[e]||null},i.prototype.getPageDimensions=function(e){if(!this._pageLookup||!this._pageLookup[e])return null;var t=n(this._pageLookup[e]);return{height:t.bottom-t.top,width:t.right-t.left}},i.prototype.getPageOffset=function(e,t){var i=this.getPageRegion(e,t);return i?{top:i.top,left:i.left}:null},i.prototype.getPageRegion=function(e,t){var i=this._pageLookup[e];if(!i)return null;var o=n(i);if(t&&t.excludePadding){var r=i.group.padding;return{top:o.top+r.top,left:o.left+r.left,bottom:o.bottom,right:o.right}}return o},i.prototype.getPageToViewportCenterOffset=function(e,t){var i=t.left,n=t.right-t.left,o=this.getPageOffset(e),r=i-o.left+parseInt(n/2,10),a=t.top,s=t.bottom-t.top,l=a-o.top+parseInt(s/2,10);return{x:r,y:l}}},function(e,t,i){"use strict";function n(e){e=e||{maxKeys:r},this.maxKeys=e.maxKeys||r,this._held={},this._urls={},this._lru=[]}var o=i(25)("diva:ImageCache");e.exports=n;var r=100;n.prototype.get=function(e){var t=this._urls[e];return t?t.img:null},n.prototype.has=function(e){return!!this._urls[e]},n.prototype.put=function(e,t){var i=this._urls[e];i?(i.img=t,this._promote(i)):(i={img:t,url:e},this._urls[e]=i,this._tryEvict(1),this._lru.unshift(i))},n.prototype._promote=function(e){var t=this._lru.indexOf(e);this._lru.splice(t,1),this._lru.unshift(e)},n.prototype._tryEvict=function(e){var t=this.maxKeys-e;if(!(this._lru.length<=t))for(var i=this._lru.length-1;;){var n=this._lru[i];if(!this._held[n.url]&&(o("Evicting image %s",n.url),this._lru.splice(i,1),delete this._urls[n.url],this._lru.length<=t))break;if(0===i){o.enabled&&o("Cache overfull by %s (all entries are being held)",this._lru.length-t);break}i--}},n.prototype.acquire=function(e){this._held[e]=(this._held[e]||0)+1,this._promote(this._urls[e])},n.prototype.release=function(e){var t=this._held[e];t>1?this._held[e]--:delete this._held[e],this._tryEvict(0)}},function(e,t,i){function n(e){this._url=e.url,this._callback=e.load,this._errorCallback=e.error,this.timeoutTime=e.timeoutTime||0,this._aborted=this._complete=!1,this.timeout=setTimeout(function(){this._image=new Image,this._image.crossOrigin="anonymous",this._image.onload=this._handleLoad.bind(this),this._image.onerror=this._handleError.bind(this),this._image.src=e.url,o("Requesting image %s",e.url)}.bind(this),this.timeoutTime)}var o=i(25)("diva:ImageRequestHandler");e.exports=n,n.prototype.abort=function(){o("Aborting request to %s",this._url),clearTimeout(this.timeout),this._image&&(this._image.onload=this._image.onerror=null,this._image.src=""),this._aborted=!0},n.prototype._handleLoad=function(){return this._aborted?void console.error("ImageRequestHandler invoked on cancelled request for "+this._url):this._complete?void console.error("ImageRequestHandler invoked on completed request for "+this._url):(this._complete=!0,o("Received image %s",this._url),void this._callback(this._image))},n.prototype._handleError=function(){o("Failed to load image %s",this._url),this._errorCallback(this._image)}},function(e,t){function i(e){function t(){var e=r(),n=Math.min((e-h)/s,1);i(n),c(f),e<d?v=requestAnimationFrame(t):a({interrupted:!1})}function i(e){p.forEach(function(t){f[t]=g[t](e)})}function a(e){v=null,u&&u(e)}var s=e.duration,l=e.parameters,c=e.onUpdate,u=e.onEnd,h=r(),d=h+s,g={},f={},p=Object.keys(l);p.forEach(function(e){var t=l[e];g[e]=n(t.from,t.to,t.easing||o)});var v=requestAnimationFrame(t);return{cancel:function(){null!==v&&(cancelAnimationFrame(v),a({interrupted:!0}))}}}function n(e,t,i){return function(n){return e+(t-e)*i(n)}}function o(e){return e}e.exports={animate:i,easing:{linear:o}};var r;r="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()}},function(e,t,i){function n(e){if(e.inGrid)return s(o(e,["manifest","viewport","pagesPerRow","fixedHeightGrid","fixedPadding","showNonPagedPages"]));var t=o(e,["manifest","verticallyOriented","showNonPagedPages"]);return e.inBookLayout?r(t):a(t)}function o(e,t){var i={};return t.forEach(function(t){i[t]=e[t]}),i}var r=i(34),a=i(36),s=i(37);e.exports=n},function(e,t,i){function n(e){var t=o(e);return t.map(function(t){return r(e,t)})}function o(e){var t=e.manifest,i=[],n=null,o=[],r=function(){for(var e=0;e<o.length;e++)i.push([o[e]]);o=[]};return t.pages.forEach(function(a,l){var c={index:l,dimensions:s(l,t),paged:!t.paged||a.paged};(e.showNonPagedPages||c.paged)&&(c.paged?0===l||a.facingPages?(i.push([c]),r()):null===n?n=c:(i.push([n,c]),n=null,r()):o.push(c))}),null!==n&&(i.push([n]),r()),i}function r(e,t){var i=e.verticallyOriented;if(2===t.length)return a(t[0],t[1],i);var n,o=t[0],r=o.dimensions;n=o.paged?0===o.index&&i?r.width:0:i?r.width/2:0;var s=i&&!e.manifest.pages[o.index].facingPages;return{dimensions:{height:r.height,width:s?2*r.width:r.width},pages:[{index:o.index,groupOffset:{top:0,left:n},dimensions:r}]}}function a(e,t,i){var n,o,r,a=e.dimensions,s=t.dimensions,l=Math.max(a.height,s.height);if(i){var c=Math.max(a.width,s.width);n=2*c,o=c-a.width,r=c}else n=a.width+s.width,o=0,r=a.width;return{dimensions:{height:l,width:n},pages:[{index:e.index,dimensions:a,groupOffset:{top:0,left:o}},{index:t.index,dimensions:s,groupOffset:{top:0,left:r}}]}}var s=i(35);e.exports=n},function(e,t){e.exports=function(e,t){var i=t.getMaxPageDimensions(e);return{width:Math.floor(i.width),height:Math.floor(i.height)}}},function(e,t,i){var n=i(35);e.exports=function(e){var t=e.manifest,i=[];return t.pages.forEach(function(o,r){if(e.showNonPagedPages||!t.paged||o.paged){var a=n(r,t);i.push({dimensions:a,pages:[{index:r,groupOffset:{top:0,left:0},dimensions:a}]})}}),i}},function(e,t){function i(e){var t=e.viewport.width,i=e.manifest,n=e.pagesPerRow,o=e.fixedHeightGrid,r=e.fixedPadding,a=e.showNonPagedPages,s=r*(n+1),l=(t-s)/n,c=l,u=o?r+i.minRatio*l:r+i.maxRatio*l,h=[],d=[],g=function(e){var t,i,n=e.d[e.d.length-1],a=n.h/n.w;return o?(t=(u-r)/a,i=u-r):(t=c,i=t*a),{width:Math.round(t),height:Math.round(i)}},f={height:u,width:t};return i.pages.forEach(function(e,t){if(a||!i.paged||e.paged){var s=g(e),l=Math.floor(d.length*(r+c)+r);o&&(l+=(c-s.width)/2),d.push({index:t,dimensions:s,groupOffset:{top:0,left:l}}),d.length===n&&(h.push({dimensions:f,pages:d}),d=[])}}),d.length>0&&h.push({dimensions:f,pages:d}),h}e.exports=i},function(e,t){function i(e){var t={};return e.forEach(function(e){n(t,e)}),t}function n(e,t){Object.keys(t).forEach(function(i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(){throw new TypeError("Cannot set settings."+i)}})})}e.exports=i},function(e,t,i){function n(e){this.whitelistedKeys=e.whitelistedKeys||[],this.additionalProperties=e.additionalProperties||[],this.validations=e.validations}function o(e,t,i){var n={proxy:{},index:null},o=a.bind(null,e,t),r={};return i.whitelistedKeys.forEach(function(e){r[e]={get:o.bind(null,e)}}),i.additionalProperties.forEach(function(e){r[e.key]={get:e.get}}),i.validations.forEach(function(e,t){r[e.key]={get:function(){if(t<n.index)return o(e.key);var r=i.validations[n.index].key;throw new TypeError("Cannot access setting "+e.key+" while validating "+r)}}}),Object.defineProperties(n.proxy,r),n}function r(e,t,i){console.warn("Invalid value for "+e+": "+t+". Using "+i+" instead.")}function a(e,t,i){return i in t?t[i]:e[i]}var s=i(3).extend;e.exports=n,n.prototype.isValid=function(e,t,i){var n=null;if(this.validations.some(function(t,i){return t.key===e&&(n=i,!0)}),null===n)return!0;var r={};r[e]=t;var a=o(i,r,this);return!this._runValidation(n,t,a)},n.prototype.validate=function(e){this._validateOptions({},e)},n.prototype.getValidatedOptions=function(e,t){var i=s({},t);return this._validateOptions(e,i),i},n.prototype._validateOptions=function(e,t){var i=o(e,t,this);this._applyValidations(t,i)},n.prototype._applyValidations=function(e,t){this.validations.forEach(function(i,n){if(e.hasOwnProperty(i.key)){var o=e[i.key],a=this._runValidation(n,o,t);a&&(a.warningSuppressed||r(i.key,o,a.value),e[i.key]=a.value)}},this)},n.prototype._runValidation=function(e,t,i){var n=this.validations[e];i.index=e;var o=!1,r={suppressWarning:function(){o=!0}},a=n.validate(t,i.proxy,r);return void 0===a||a===t?null:{value:a,warningSuppressed:o}}},function(e,t){function i(e,t){t=t||{},this.intersectionTolerance=t.intersectionTolerance||0,this.maxExtent=t.maxExtent||2e3,this.outer=e,this._top=this._left=this._width=this._height=this._innerDimensions=null,this.invalidate()}function n(e,t){var i="_"+e,n="scroll"+e.charAt(0).toUpperCase()+e.slice(1);return{get:function(){return this[i]},set:function(e){var o;if(this._innerDimensions){var r=this._innerDimensions[t]-this[t];o=a(e,0,r)}else o=s(e,0);this[i]=this.outer[n]=o}}}function o(e){return{get:function(){return this["_"+e]}}}function r(e,t,i){return e>=t&&e<=i}function a(e,t,i){return s(l(e,i),t)}function s(e,t){return Math.max(e,t)}function l(e,t){return Math.min(e,t)}e.exports=i,i.prototype.intersectsRegion=function(e){return this.hasHorizontalOverlap(e)&&this.hasVerticalOverlap(e)},i.prototype.hasVerticalOverlap=function(e){var t=this.top-this.intersectionTolerance,i=this.bottom+this.intersectionTolerance;return r(e.top,t,i)||r(e.bottom,t,i)||e.top<=t&&e.bottom>=i},i.prototype.hasHorizontalOverlap=function(e){var t=this.left-this.intersectionTolerance,i=this.right+this.intersectionTolerance;return r(e.left,t,i)||r(e.right,t,i)||e.left<=t&&e.right>=i},i.prototype.invalidate=function(){this._width=l(this.outer.clientWidth,this.maxExtent),this._height=l(this.outer.clientHeight,this.maxExtent),this._top=this.outer.scrollTop,this._left=this.outer.scrollLeft},i.prototype.setInnerDimensions=function(e){this._innerDimensions=e,e&&(this._top=a(this._top,0,e.height-this._height),this._left=a(this._left,0,e.width-this._width))},Object.defineProperties(i.prototype,{top:n("top","height"),left:n("left","width"),width:o("width"),height:o("height"),bottom:{get:function(){return this._top+this._height}},right:{get:function(){return this._left+this._width}}})},function(e,t,i){var n=i(3),o=i(7);i(15),function(t){e.exports=function(){var e,i,n,r={},a={},s={},l={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:.05,localStoragePrefix:"canvas-",mobileWebkitMaxZoom:2,rgbMax:50,rgbMin:-50,throbberFadeSpeed:200,throbberTimeout:100,buttons:["contrast","brightness","rotation","zoom"]},c=function(e){return e*Math.PI/180},u=function(e,t){var n=e.x-r.centerX,o=-(e.y-r.centerY),a=c(i.rotation.previous-t),s=Math.cos(a)*n-Math.sin(a)*o+r.centerX,l=-(Math.sin(a)*n+Math.cos(a)*o)+r.centerY;return{x:s,y:l}},h=function(t,i){var n=t.context,o=t.size/2,r=-(t.width/2),a=-(t.height/2);n.clearRect(0,0,t.size,t.size),n.save(),n.translate(o,o),n.rotate(c(i)),n.drawImage(e,r,a,t.width,t.height),n.restore(),t.data=n.getImageData(0,0,t.size,t.size)},d=function(){var e;for(e in i)if(i[e].current!==i[e].previous)return!0;return!1},g=function(){var e;for(e in i)i[e].previous=i[e].current},f=function(){h(a,i.rotation.current),w(a)},p=function(){var e=i.rotation.current,n=i.rotation.previous,o=i.zoom.current,a=i.zoom.previous;if(e!==n||o!==a){var l=t("#diva-canvas-wrapper").scrollLeft(),c=t("#diva-canvas-wrapper").scrollTop(),f=s.viewport.width/2,p=s.viewport.height/2,v=u({x:l+f,y:c+p},e),m=Math.pow(2,o-a),y=m*v.x-f,b=m*v.y-p;h(r,e),t("#diva-canvas-wrapper").scrollLeft(y),t("#diva-canvas-wrapper").scrollTop(b)}d()&&(w(r),g())},v=function(e){var t,i,n=e.data,o=e.context.createImageData(n),r=o.data;for(t=0,i=r.length;t<i;t++)r[t]=n.data[t];return o},m=function(e){var t=i[e].current!==i[e].previous,n=i[e].current!==i[e].initial;return t||n},w=function(e){var t,n,o,r,a,l,c,u,h=v(e),d=h.data,g=i.brightness.current,f=i.contrast.current,p=1+Math.min(s.brightnessMax,Math.max(s.brightnessMin,g))/s.brightnessMax,w=p*f,y=128-128*f,b=i.red.current,_=i.green.current,P=i.blue.current,x=m("red"),I=m("green"),L=m("blue"),C=m("brightness"),O=m("contrast"),D=C||O;for(t=0,o=h.width;t<o;t++)for(n=0,r=h.height;n<r;n++)a=4*(n*o+t),l=d[a],c=d[a+1],u=d[a+2],l+c+u>0&&(x&&l&&(l+=b),I&&c&&(c+=_),L&&u&&(u+=P),D&&(l&&(l=l*w+y),c&&(c=c*w+y),u&&(u=u*w+y)),d[a]=l,d[a+1]=c,d[a+2]=u);e.context.clearRect(0,0,o,r),e.context.putImageData(h,0,0)},y=function(){var e=t("#diva-canvas-wrapper").scrollLeft()*a.scaleFactor,i=t("#diva-canvas-wrapper").scrollTop()*a.scaleFactor,n=Math.min(Math.round(s.viewport.height*a.scaleFactor),s.mapSize)-4,o=Math.min(Math.round(s.viewport.width*a.scaleFactor),s.mapSize)-4;t("#diva-map-viewbox").height(n).width(o).css({top:i,left:e})},b=function(e){a.canvas=document.getElementById("diva-canvas-minimap"),a.size=s.mapSize,a.canvas.width=a.size,a.canvas.height=a.size,a.context=a.canvas.getContext("2d"),a.context.fillRect(0,0,a.size,a.size),a.scaleFactor=s.mapSize/r.size,a.cornerX=r.cornerX*a.scaleFactor,a.cornerY=r.cornerY*a.scaleFactor,a.width=e.width*a.scaleFactor,a.height=e.height*a.scaleFactor,a.context.drawImage(e,a.cornerX,a.cornerY,a.width,a.height),a.data=a.context.getImageData(0,0,s.mapSize,s.mapSize),t("#diva-map-viewbox").show(),y()},_=function(i,n){e=new Image,e.crossOrigin="anonymous",e.onload=function(){r.size=Math.sqrt(e.width*e.width+e.height*e.height),r.canvas=document.getElementById("diva-canvas"),r.canvas.width=r.size,r.canvas.height=r.size,r.cornerX=(r.size-e.width)/2,r.cornerY=(r.size-e.height)/2,r.width=e.width,r.height=e.height,r.centerX=r.size/2,r.centerY=r.size/2,r.context=r.canvas.getContext("2d"),r.context.drawImage(e,r.cornerX,r.cornerY,r.width,r.height);try{r.data=r.context.getImageData(0,0,r.size,r.size)}catch(i){var o='<div id="diva-error" class="diva-error"><p><strong>Error</strong></p><p>'+i.message+"</p>";if("SecurityError"!==i.name)throw i;o+='<p>You may need to update your server configuration in order to use the image manipulation tools. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-canvas-and-cross-site-data" target="_blank">canvas cross-site data documentation</a>.</p></div>',o+="</div>",t("#diva-canvas-backdrop").append(o),C()}void 0===n&&b(e),f(),p(r),C(),"function"==typeof n&&n.call(n)},e.src=i,(e.complete||void 0===e.complete)&&(e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",e.src=i)},P=function(){var e=i[n],o=e.current,r=e.transform?e.transform(o):o;t("#diva-canvas-value").html(r)},x=function(){t("#diva-canvas-slider").val(i[n].current)},I=function(e){var t=s.zoomWidthRatio*Math.pow(2,e);return s.divaInstance.getPageImageURL(s.selectedPageIndex,{width:t})},L=function(){(i.zoom.current>0||s.mobileWebkit)&&t(s.selector+"throbber").addClass("canvas-throbber").show()},C=function(){t(s.selector+"throbber").removeClass("canvas-throbber").hide()},O=function(){var e,t={},n=!1,o=s.localStoragePrefix+s.filename;for(e in i)i[e].previous!==i[e].initial&&(t[e]=i[e].previous,n=!0);n?(s.pluginIcon.addClass("new"),k(o,t)):(s.pluginIcon.removeClass("new"),localStorage.removeItem(o))},D=function(e,t){s.zoomLevel=e;var i=I(e);_(i,function(){a.scaleFactor=a.size/r.size,y(),O()})},T=function(e){var i=38,n=40,o=37,r=39;switch(e.keyCode){case i:return t("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop-s.arrowScrollAmount),!1;case n:return t("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop+s.arrowScrollAmount),!1;case o:return t("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft-s.arrowScrollAmount),!1;case r:return t("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft+s.arrowScrollAmount),!1}},k=function(e,t){localStorage.setItem(e,JSON.stringify(t))},S=function(e){var t=localStorage.getItem(e);return t&&JSON.parse(t)},E={init:function(e,c){var u=!!window.HTMLCanvasElement;if(!u)return!1;t.extend(s,l,e.canvasPlugin),s.divaInstance=c,s.inCanvas=!1,s.iipServerURL=e.iipServerURL,s.imageDir=e.imageDir,s.selector=e.selector,s.mobileWebkit=e.mobileWebkit,s.arrowScrollAmount=e.arrowScrollAmount,i={contrast:{initial:1,min:s.contrastMin,max:s.contrastMax,step:s.contrastStep,transform:function(e){return e.toFixed(2)},title:"Change the contrast"},brightness:{initial:0,min:s.brightnessMin,max:s.brightnessMax,step:s.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,min:0,max:359,step:1,transform:function(e){return e+"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:s.rgbMin,max:s.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:s.rgbMin,max:s.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:s.rgbMin,max:s.rgbMax,step:1,title:"Adjust the blue channel"}};var h=function(){var e,t,n;for(n in i)t=i[n],e=t.initial,t.current=e,t.previous=e};if(h(),t("#diva-canvas-backdrop").length)return!0;var g,v,m,w,b=[];for(w in s.buttons)v=s.buttons[w],m=i[v].title,g='<div class="'+v+'" title="'+m+'"></div>',b.push(g);var _=b.join(""),I='<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+_+'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><input type="range" id="diva-canvas-slider"></input></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>',k='<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div>',S='<div id="diva-canvas-backdrop">'+I+k+"</div>";t("body").append(S),s.mapSize=t("#diva-canvas-minimap").width(),t("#diva-canvas-buttons div").click(function(){t("#diva-canvas-buttons .clicked").removeClass("clicked"),E(t(this).attr("class"))});var E=function(e){n=e;var o=i[n];t("#diva-canvas-buttons ."+n).addClass("clicked"),t("#diva-canvas-mode").text(n);var r=o.current,a=o.transform?o.transform(r):r,s=document.getElementById("diva-canvas-slider");s.min=o.min,s.max=o.max,s.step=o.step,t("#diva-canvas-slider").val(r),t("#diva-canvas-value").html(a)};return E("contrast"),t("#diva-canvas-slider").on("input",function(e){i[n].current=parseFloat(this.value),P(),f()}),t("#diva-canvas-reset-all").click(function(){var e;for(e in i)i[e].current=i[e].initial;P(),x(),f()}),t("#diva-canvas-reset").click(function(){i[n].current=i[n].initial,P(),x(),f()}),t("#diva-canvas-apply").click(function(){d()&&(L(),setTimeout(function(){i.zoom.current!==i.zoom.previous?D(i.zoom.current):(p(),C(),O())},s.throbberTimeout))}),t("#diva-canvas-close").click(function(){t("body").removeClass("overflow-hidden"),r.context.clearRect(0,0,r.size,r.size),a.context.clearRect(0,0,a.size,a.size),t("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0),t("#diva-canvas-backdrop").hide(),t("#diva-map-viewbox").hide(),C(),c.enableScrollable(),t(document).off("keydown",T),h(),P(),x(),t("#diva-canvas-buttons .clicked").removeClass("clicked"),E("contrast"),o.Events.publish("CanvasViewDidHide")}),t("#diva-canvas-minimise").click(function(){t("#diva-canvas-toolwindow").slideToggle("fast")}),t(window).resize(function(){s.viewport={height:window.innerHeight-e.scrollbarWidth,width:window.innerWidth-e.scrollbarWidth},s.inCanvas&&y()}),t("#diva-canvas-wrapper").scroll(function(){
s.inCanvas&&y()}),t("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(e){var i=t("#diva-canvas-minimap").offset(),n=(e.pageX-i.left)/a.scaleFactor,o=(e.pageY-i.top)/a.scaleFactor;t("#diva-canvas-wrapper").scrollTop(o-s.viewport.height/2),t("#diva-canvas-wrapper").scrollLeft(n-s.viewport.width/2)}),t("#diva-canvas").mousedown(function(){t(this).addClass("grabbing")}).mouseup(function(){t(this).removeClass("grabbing")}),t("#diva-canvas-wrapper").kinetic(),t("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0}),o.Events.subscribe("ObjectDidLoad",this.setupHook,e.ID),o.Events.subscribe("ViewerDidTerminate",this.destroy,e.ID),o.Events.subscribe("PageDidLoad",this.onPageLoad,e.ID),!0},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(e){s.viewport={height:window.innerHeight-e.scrollbarWidth,width:window.innerWidth-e.scrollbarWidth},s.minZoomLevel=e.minZoomLevel,s.maxZoomLevel=e.maxZoomLevel,s.mobileWebkit&&(s.maxZoomLevel=Math.min(s.maxZoomLevel,s.mobileWebkitMaxZoom)),i.zoom.min=s.minZoomLevel,i.zoom.max=s.maxZoomLevel},handleClick:function(e,r,a,l){var c,u=a.getFilenames()[l],h=a.getPageDimensions(l).width-1,d=r.zoomLevel;s.zoomWidthRatio=h/Math.pow(2,d),s.pluginIcon=t(this),s.manifest=r.manifest,s.selectedPageIndex=l,s.mobileWebkit&&(d=Math.min(s.maxZoomLevel,d)),s.filename=u,i.zoom.initial=d,i.zoom.current=d;var g=S(s.localStoragePrefix+s.filename);if(g)for(c in g)i[c].current=g[c],c===n&&(P(),x()),"zoom"===c&&(d=g[c]);i.zoom.previous=d,t("body").addClass("overflow-hidden"),t("#diva-canvas-backdrop").show(),a.disableScrollable(),t(document).keydown(T),s.inCanvas=!0;var f=I(d);t("#diva-canvas-info").text("Page "+(l+1)),L(),o.Events.publish("CanvasViewDidActivate",[l]),_(f)},onPageLoad:function(e,i,n){var o=s.localStoragePrefix+i;null!==localStorage.getItem(o)&&t(n).find(".diva-canvas-icon").addClass("new")},destroy:function(e,i){t("#diva-canvas-backdrop").remove()}};return E}()}(n)},function(e,t,i){var n=i(3);!function(t){e.exports=function(){var e={},t={init:function(t,i){return e.divaInstance=i,!0},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(t,i,n,o){var r=n.getPageDimensions(o).width-1,a=e.divaInstance.getPageImageURL(o,{width:r});window.open(a)}};return t}()}(n)},function(e,t,i){function n(e,t){this._divaInstance=e,this._overlays={},this._getCurrentHighlight=t}function o(e,t,i){this.page=e.page,this.highlight=e,this._highlightRegions=[],this._divaInstance=t,this._getCurrentHighlight=i}function r(e,t){return e/Math.pow(2,t)}function a(e,t){var i,n,o,r=e.getInstanceId()+"selected-highlight",a=document.getElementsByClassName(r);for(i=0;i<a.length;i++)n=a[i],n.id!==t.id&&(n.className=n.className.replace(" "+r,""),n.style.border="1px solid #555");if(e.isPageInViewport(t.page))for(o=document.querySelectorAll("*[data-highlight-id="+t.id+"]"),i=0;i<o.length;i++)n=o[i],n.className=n.className+" "+r,n.style.border="2px solid #000"}var s=i(3),l=i(8),c=i(7);!function(t){e.exports=function(){var e={init:function(e,t){var i=new n(t);e.parentObject.data("highlightManager",i);var o;t.resetHighlights=function(){i.clear()},t.removeHighlightsOnPage=function(e){i.removeHighlightsOnPage(e)},t.highlightOnPages=function(e,i,n,o){for(var r=e.length;r--;)t.highlightOnPage(e[r],i[r],n,o)},t.highlightOnPage=function(t,n,o,r){return void 0===o&&(o="rgba(255, 0, 0, 0.2)"),r=void 0===r?e.ID+"highlight diva-highlight":e.ID+"highlight diva-highlight "+r,i.addHighlight({page:t,regions:n,colour:o,divClass:r}),!0},t.gotoHighlight=function(e){var t=i.getHighlightByRegionId(e);return t?r(t.highlight.page,t.region):(console.warn("Diva just tried to find a highlight that doesn't exist."),!1)};var r=function(i,n){var r=parseFloat(n.uly)+parseFloat(n.height)/2,s=parseFloat(n.ulx)+parseFloat(n.width)/2,l=t.translateFromMaxZoomLevel(r),u=t.translateFromMaxZoomLevel(s);i=parseInt(i,10),t.gotoPageByIndex(i);var h=t.getSettings().viewportObject,d=h.scrollTop()+l-h.height()/2+e.verticalPadding,g=h.scrollLeft()+u-h.width()/2+e.horizontalPadding;return h.scrollTop(d),h.scrollLeft(g),o={region:n,page:i},c.Events.publish("SelectedHighlightChanged",[n.id,o.page]),a(t,o),n.id},s=function(i){return e.verticallyOriented?t.translateFromMaxZoomLevel(parseFloat(i.uly)+parseFloat(i.height)/2):t.translateFromMaxZoomLevel(parseFloat(i.ulx)+parseFloat(i.width)/2)},l=function(n){var a,l,c,u,h,d,g,f,p,v,m=!1;for(o?(c=o.page,l=s(o.region)):(l=0,c=0),u=i.getHighlightRegions(c),h=u.length,d=t.getPageDimensionsAtZoomLevel(c,t.getZoomLevel()),a=n?e.verticallyOriented?d.height:d.width:0,v=n?function(e,t,i){return e>t&&e<i}:function(e,t,i){return e<t&&e>i};h--;)p=u[h],g=s(p),v(g,l,a)&&(m=!0,a=g,f=p);if(m)return r(c,f);var w,y=i.getHighlightedPages(),b=y.indexOf(c.toString());if(n)for(;!w||!t.isPageIndexValid(w);)w=b==y.length-1?y[0]:y[++b];else for(;!w||!t.isPageIndexValid(w);)w=0===b?y[y.length-1]:y[--b];for(u=i.getHighlightRegions(w),h=u.length,d=t.getPageDimensionsAtZoomLevel(w,t.getMaxZoomLevel()),a=n?e.verticallyOriented?d.height:d.width:0,v=n?function(e,t){return e<t}:function(e,t){return e>t};h--;)p=u[h],g=s(p),v(g,a)&&(m=!0,a=g,f=p);return r(w,f)};return t.gotoNextHighlight=function(){return i.getHighlightCount()>0&&l(!0)},t.gotoPreviousHighlight=function(){return i.getHighlightCount()>0&&l(!1)},c.Events.subscribe("ViewerWillTerminate",this.destroy,e.ID),!0},destroy:function(e){var t=e.parentObject.data("highlightManager");t.clear(),e.parentObject.removeData("highlightManager")},pluginName:"highlight",titleText:"Highlight regions of pages",HighlightManager:n};return e}()}(s),n.prototype.getHighlightCount=function(){var e=0;return Object.keys(this._overlays).forEach(function(t){e+=this._overlays[t].highlight.regions.length},this),e},n.prototype.getHighlightRegions=function(e){return this._overlays[e]?this._overlays[e].highlight.regions:[]},n.prototype.getHighlightedPages=function(){return Object.keys(this._overlays)},n.prototype.getHighlightByRegionId=function(e){for(var t in this._overlays)if(this._overlays.hasOwnProperty(t)){var i=this._overlays[t].highlight.regions;for(var n in i)if(i.hasOwnProperty(n)&&i[n].divID===e)return{highlight:this._overlays[t].highlight,region:i[n]}}return null},n.prototype.addHighlight=function(e){var t=this._overlays[e.page];t&&this._divaInstance.__removePageOverlay(t);var i=new o(e,this._divaInstance,this._getCurrentHighlight);this._overlays[e.page]=i,this._divaInstance.__addPageOverlay(i)},n.prototype.removeHighlightsOnPage=function(e){this._overlays[e]&&(this._divaInstance.__removePageOverlay(this._overlays[e]),delete this._overlays[e])},n.prototype.clear=function(){for(var e in this._overlays)this._overlays.hasOwnProperty(e)&&this._divaInstance.__removePageOverlay(this._overlays[e]);this._overlays={}},o.prototype.mount=function(){for(var e=this._divaInstance.getSettings(),t=this.highlight,i=t.regions,n=t.colour,o=t.divClass,r=i.length;r--;){var s=i[r],u=l("div",{"class":o,style:{background:n,border:"1px solid #555",position:"absolute",zIndex:100}});void 0!==s.divID&&u.setAttribute("data-highlight-id",s.divID),void 0!==s.name&&u.setAttribute("data-name",s.name),this._highlightRegions.push({element:u,region:s})}this.refresh();var h=document.createDocumentFragment();this._highlightRegions.forEach(function(e){h.appendChild(e.element)}),e.innerElement.appendChild(h),this._getCurrentHighlight&&a(this._divaInstance,this._getCurrentHighlight()),c.Events.publish("HighlightCompleted",[this.page,this._divaInstance.getFilenames()[this.page]])},o.prototype.unmount=function(){var e=this._divaInstance.getSettings().innerElement;this._highlightRegions.forEach(function(t){e.removeChild(t.element)}),this._highlightRegions=[]},o.prototype.refresh=function(){var e=this._divaInstance.getMaxZoomLevel(),t=this._divaInstance.getPageDimensionsAtZoomLevel(this.page,e).width,i=this._divaInstance.getPageDimensions(this.page).width,n=Math.log(t/i)/Math.log(2),o=this._divaInstance.getPageOffset(this.page,{excludePadding:!0,incorporateViewport:!0});this._highlightRegions.forEach(function(e){var t=e.region;l.setAttributes(e.element,{style:{width:r(t.width,n)+"px",height:r(t.height,n)+"px",top:o.top+r(t.uly,n)+"px",left:o.left+r(t.ulx,n)+"px"}})})}},function(e,t,i){var n=i(3),o=i(7),r=i(43).HighlightManager;!function(t){e.exports=function(){var e={},i={init:function(i,n){var a=new r(n);i.parentObject.data("highlightManager",a),e.highlightedPages=[],n.resetHighlights=function(){a.clear()},n.removeHighlightsOnPage=function(e){a.removeHighlightsOnPage(e)},n.hideHighlights=function(){e.highlightsVisible=!1,t(i.innerElement).addClass("annotations-hidden")},n.showHighlights=function(){e.highlightsVisible=!0,t(i.innerElement).removeClass("annotations-hidden")},n.highlightOnPages=function(e,t,i,o){for(var r=e.length;r--;)n.highlightOnPage(e[r],t[r],i,o)},n.highlightOnPage=function(e,t,n,o){return void 0===n&&(n="rgba(255, 0, 0, 0.2)"),o=void 0===o?i.ID+"highlight diva-highlight":i.ID+"highlight diva-highlight "+o,a.addHighlight({page:e,regions:t,colour:n,divClass:o}),!0},n.gotoHighlight=function(e){var t=a.getHighlightByRegionId(e);return t?s(t.highlight.page,t.region):(console.warn("Diva just tried to find a highlight that doesn't exist."),!1)};var s=function(e,t){var o=parseFloat(t.uly)+parseFloat(t.height)/2,r=parseFloat(t.ulx)+parseFloat(t.width)/2,a=n.translateFromMaxZoomLevel(o),s=n.translateFromMaxZoomLevel(r);e=parseInt(e,10),n.gotoPageByIndex(e);var l=n.getSettings().viewportObject,c=l.scrollTop()+a-l.height()/2+i.verticalPadding,u=l.scrollLeft()+s-l.width()/2+i.horizontalPadding;l.scrollTop(c),l.scrollLeft(u)},l=function(t){return function(i,o,r){for(var a=i,s=i.length,l=[],c=0;c<s;c++){var u=a[c],h=u.resource.chars,d=u.on,g=d.slice(d.indexOf("#xywh=")+6),f=g.split(","),p={ulx:parseInt(f[0],10),uly:parseInt(f[1],10),width:parseInt(f[2],10),height:parseInt(f[3],10),name:h};l.push(p)}n.highlightOnPage(t,l),e.highlightedPages.push(t)}},c=function(i){var n=e.manifest.sequences[0].canvases;if(n[i].hasOwnProperty("otherContent"))for(var o=n[i].otherContent,r=0;r<o.length;r++)"sc:AnnotationList"===o[r]["@type"]&&t.ajax({url:o[r]["@id"],cache:!0,dataType:"json",success:l(i)})},u=function(t){e.manifest=t};o.Events.subscribe("ManifestDidLoad",u,i.ID),o.Events.subscribe("PageWillLoad",function(t){if(e.highlightsVisible){for(var i=0;i<e.highlightedPages.length;i++)if(e.highlightedPages[i]===t)return;c(t,e.manifest)}},i.ID);var h=[];return i.innerObject.on("mouseenter","."+i.ID+"highlight",function(e){var t=e.target,i=t.dataset.name,n=document.createElement("div");n.style.top=t.offsetTop+t.offsetHeight-1+"px",n.style.left=t.style.left,n.style.background="#fff",n.style.border="1px solid #555",n.style.position="absolute",n.style.zIndex=101,n.className="annotation-overlay",n.textContent=i,t.parentNode.appendChild(n),h.push(n)}),i.innerObject.on("mouseleave","."+i.ID+"highlight",function(e){for(;h.length;){var t=h.pop();t.parentNode.removeChild(t)}}),o.Events.subscribe("ViewerDidLoad",function(){t("#"+i.ID+"page-nav").before('<div id="'+i.ID+'annotations-icon" class="diva-button diva-annotations-icon" title="Turn annotations on or off"></div>'),t(i.selector+"annotations-icon").addClass("annotations-icon-active"),t("#"+i.ID+"annotations-icon").on("click",function(o){e.highlightsVisible?(n.hideHighlights(),t(i.selector+"annotations-icon").removeClass("annotations-icon-active")):(n.showHighlights(),t(i.selector+"annotations-icon").addClass("annotations-icon-active"))})},i.ID),e.highlightsVisible=!0,!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"IIIFHighlight",titleText:"Highlight regions of pages"};return i}()}(n)},function(e,t,i){var n=i(3),o=i(7);!function(t){e.exports=function(){var e={init:function(e,i){var n=function(i){var n=function(e,t){var i=e.charAt(0).toUpperCase()+e.slice(1),n=i.replace("_"," ");return t.match(/^https?:\/\//)&&(t='<a href="'+t+'" target="_blank">'+t+"</a>"),'<div class="metadata-row"><span class="metadata-label">'+n+':</span> <span class="metadata-value">'+t+"</span></div>"},o=function(e,t){for(var i=0;i<e.length;i++)if(e[i]["@language"]===t)return e[i]["@value"];return e[0]["@value"]||e["@value"]},r=function(e){for(var t="",r=0;r<e.length;r++){var a=e[r];if(i.hasOwnProperty(a))if(i[a].constructor===Array){var s=o(i[a],"en");t+=n(a,s)}else t+=n(a,i[a])}return t},a='<div id="'+e.ID+'metadata" class="diva-modal">';if(a+=r(["label"]),i.hasOwnProperty("metadata"))for(var s=i.metadata,l=0;l<s.length;l++)if(s[l].value.constructor===Array){var c=o(s[l].value,"en");a+=n(s[l].label,c)}else a+=n(s[l].label,s[l].value);a+=r(["description","within","see_also","license","attribution"]),a+="</div>",e.parentObject.prepend(a),t(e.selector+"metadata").hide()};return o.Events.subscribe("ManifestDidLoad",n,e.ID),e.parentObject.prepend('<div style="text-align: center; clear: both"><a href="#" id="'+e.ID+'metadata-link" class="diva-metadata-link">Details</a></div>'),t(e.selector+"metadata-link").on("click",function(i){t(e.selector+"metadata").fadeToggle("fast")}),!0},destroy:function(e,t){},pluginName:"IIIFMetadata",titleText:"Show metadata from a IIIF manifest"};return e}()}(n)}])});
//# sourceMappingURL=diva.min.js.map